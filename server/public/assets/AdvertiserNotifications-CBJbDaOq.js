import{j as e}from"./ui-CkQMVfNu.js";import{u as C}from"./useQuery-IUx4ZSsA.js";import{c as T,u as $,d as q,K as A,r as E,N as l,B as x,C as B,e as K,f as z,g as F,m as R,A as c,y as N,p as M}from"./index-Hu68kGEe.js";import{u as h}from"./useMutation-HxEtoRum.js";import{B as p}from"./badge-BPEJ7H1K.js";import{T as P,a as Q,b as y,c as n,d as S,e as d}from"./table-D9zFYVHJ.js";import{f as L}from"./utils-B-_CankM.js";import{T as D}from"./trash-2-BgkAOTI8.js";import{C as H}from"./clock-HOqnpwZm.js";import{r as I}from"./ru-amAWtAem.js";import"./vendor-DazevGLP.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=T("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);function te(){const{user:v}=$(),{toast:t}=q(),{t:V}=A(),o=E(),{data:i=[],isLoading:b}=C({queryKey:["/api/notifications"],enabled:!!v?.id}),u=()=>{const a=localStorage.getItem("auth_token");return a&&a!=="null"&&a!=="undefined"&&a.trim()!==""?a:null},j=h({mutationKey:["markAsRead"],mutationFn:async a=>{const s=u();if(!s)throw new Error("Authentication required - please re-login");const r=await fetch(`/api/notifications/${a}/read`,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to mark as read: ${r.status}`);return r.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"✅ Успешно",description:"Уведомление отмечено как прочитанное",variant:"default"})},onError:a=>{console.error("❌ Ошибка отметки как прочитанное:",a),t({title:"❌ Ошибка",description:a.message||"Не удалось отметить уведомление",variant:"destructive"})}}),f=h({mutationKey:["deleteNotification"],mutationFn:async a=>{const s=u();if(!s)throw new Error("Authentication required - please re-login");const r=await fetch(`/api/notifications/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Failed to delete: ${r.status}`);return r.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"✅ Удалено",description:"Уведомление успешно удалено",variant:"default"})},onError:a=>{console.error("❌ Ошибка удаления:",a),t({title:"❌ Ошибка",description:a.message||"Не удалось удалить уведомление",variant:"destructive"})}}),g=h({mutationKey:["markAllAsRead"],mutationFn:async()=>{const a=u();if(!a)throw new Error("Authentication required - please re-login");const s=await fetch("/api/notifications/mark-all-read",{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to mark all as read: ${s.status}`);return s.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["/api/notifications"]}),t({title:"✅ Выполнено",description:"Все уведомления отмечены как прочитанные",variant:"default"})}}),k=a=>{const s="h-4 w-4";switch(a){case"offer_request_approved":return e.jsx(c,{className:`${s} text-green-500`});case"offer_request_rejected":return e.jsx(N,{className:`${s} text-red-500`});case"offer_request_created":return e.jsx(H,{className:`${s} text-blue-500`});case"payment":return e.jsx(c,{className:`${s} text-green-500`});case"partner_joined":return e.jsx(c,{className:`${s} text-blue-500`});case"offer_paused":return e.jsx(M,{className:`${s} text-orange-500`});case"antifraud_alert":return e.jsx(N,{className:`${s} text-red-500`});default:return e.jsx(l,{className:`${s} text-gray-500`})}},w=a=>{switch(a){case"offer_request_approved":case"payment":case"partner_joined":return"default";case"offer_request_rejected":case"antifraud_alert":return"destructive";case"offer_request_created":return"secondary";default:return"outline"}},_=a=>{switch(a){case"offer_request_approved":return"Заявка одобрена";case"offer_request_rejected":return"Заявка отклонена";case"offer_request_created":return"Новая заявка";case"payment":return"Платеж";case"partner_joined":return"Новый партнер";case"offer_paused":return"Оффер приостановлен";case"antifraud_alert":return"Антифрод";case"general":return"Общее";default:return"Уведомление"}},m=i.filter(a=>!a.is_read).length;return b?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-muted-foreground",children:"Загрузка уведомлений..."})})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Уведомления"}),e.jsx("p",{className:"text-muted-foreground",children:"Системные уведомления и оповещения"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m>0&&e.jsxs(p,{variant:"destructive",className:"px-3 py-1",children:[m," непрочитанных"]}),e.jsxs(x,{onClick:()=>g.mutate(),disabled:g.isPending||m===0,variant:"outline",size:"sm",title:"Отметить все как прочитанные",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Отметить все"]})]})]}),e.jsxs(B,{children:[e.jsx(K,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-5 w-5"}),"Все уведомления (",i.length,")"]})}),e.jsx(F,{children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(l,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Уведомлений пока нет"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Здесь будут отображаться системные оповещения"})]}):e.jsxs(P,{children:[e.jsx(Q,{children:e.jsxs(y,{children:[e.jsx(n,{className:"w-[50px]",children:"Статус"}),e.jsx(n,{className:"w-[120px]",children:"Тип"}),e.jsx(n,{children:"Сообщение"}),e.jsx(n,{className:"w-[150px]",children:"Дата"}),e.jsx(n,{className:"w-[120px]",children:"Действия"})]})}),e.jsx(S,{children:i.map(a=>e.jsxs(y,{className:`transition-colors ${a.is_read?"bg-gray-50/30 dark:bg-gray-800/20 hover:bg-gray-50/50 dark:hover:bg-gray-800/30":"bg-blue-50/80 dark:bg-blue-950/30 border-l-4 border-l-blue-500"}`,children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-center",children:[!a.is_read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-2"}),k(a.type)]})}),e.jsx(d,{children:e.jsx(p,{variant:w(a.type),className:`text-xs ${a.is_read?"":"ring-2 ring-blue-200"}`,children:_(a.type)})}),e.jsx(d,{children:e.jsxs("div",{className:`${a.is_read?"text-gray-600 dark:text-gray-300":"font-semibold text-gray-900 dark:text-white"}`,children:[e.jsx("div",{className:`${a.is_read?"font-medium":"font-bold"}`,children:a.title}),e.jsx("div",{className:`text-sm mt-1 ${a.is_read?"text-muted-foreground":"text-gray-700 dark:text-gray-200"}`,children:a.message}),a.metadata&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[a.metadata.offerName&&e.jsxs("span",{children:["Оффер: ",a.metadata.offerName]}),a.metadata.partnerName&&e.jsxs("span",{children:["Партнер: ",a.metadata.partnerName]}),a.metadata.amount&&e.jsxs("span",{children:["Сумма: ",a.metadata.amount," ",a.metadata.currency]})]})]})}),e.jsx(d,{children:e.jsx("div",{className:`text-sm ${a.is_read?"text-muted-foreground":"text-gray-600 dark:text-gray-300 font-medium"}`,children:L(new Date(a.created_at),{addSuffix:!0,locale:I})})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[a.is_read?e.jsxs(p,{variant:"secondary",className:"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(c,{className:"h-3 w-3 mr-1"}),"Прочитано"]}):e.jsxs(x,{onClick:()=>j.mutate(a.id),disabled:j.isPending,variant:"outline",size:"sm",className:"bg-blue-500 hover:bg-blue-600 text-white border-blue-500 hover:border-blue-600",title:"Отметить как прочитанное",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Прочитано"]}),e.jsx(x,{onClick:()=>f.mutate(a.id),disabled:f.isPending,variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",title:"Удалить уведомление",children:e.jsx(D,{className:"h-4 w-4"})})]})})]},a.id))})]})})]})]})}export{te as default};
