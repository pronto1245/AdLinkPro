import{j as e}from"./ui-CkQMVfNu.js";import{r as x,b as me}from"./vendor-DazevGLP.js";import{u as ee}from"./useQuery-qpsyHy1X.js";import{C as W,a as ue,g as H,B as p,D as he,O as xe,K as ge,d as je,r as fe,e as se,G as be,f as te,S as ke,z as ye,o as ve,y as Ne,L as d,I as T,h as L,i as R,j as M,k as A,l as f,P as Te}from"./index-BiZ3ky40.js";import{u as F}from"./useMutation-21NtthE3.js";import{a as I}from"./queryClient-DKT_jxev.js";import{T as Se}from"./textarea-C_vyxygv.js";import{S as Ee}from"./switch-D5hnHzuw.js";import{B as b}from"./badge-B53pzHyE.js";import{T as we,a as Ce,b as ae,c as oe}from"./tabs-BZv1t_-o.js";import{D as $,a as K,b as Q,c as V,d as z}from"./dialog-BZ5LljxY.js";import{T as _e,a as Pe,b as Y,c as S,d as Ie,e as N}from"./table-BX93bJ8w.js";import{R as Z}from"./refresh-cw-Cwf3MaQN.js";import{P as re}from"./plus-DSksiBTA.js";import{P as De}from"./play-Bn29VMET.js";import{T as Oe}from"./trash-2-BRxBRszM.js";import{C as Le}from"./clock-BdukKcj2.js";import{Z as Re}from"./zap-Dxt2dweZ.js";import"./utils-B-_CankM.js";function Me({icon:t=e.jsx(xe,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),title:k,description:_,action:E,secondaryAction:m,details:u,className:w,showDetails:G=!0,onRefresh:y}){const U=()=>{console.log("üîÑ EmptyState: Forced refresh triggered",{timestamp:new Date().toISOString(),details:u}),y&&y()};return e.jsx(W,{className:ue("",w),"data-testid":"empty-state",children:e.jsxs(H,{className:"text-center py-8",children:[t,e.jsx("h3",{className:"text-lg font-medium mb-2",children:k}),e.jsx("p",{className:"text-muted-foreground mb-4",children:_}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center mb-6",children:[E&&e.jsxs(p,{onClick:E.onClick,className:"gap-2",children:[E.icon,E.label]}),y&&e.jsxs(p,{onClick:U,variant:"outline",className:"gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"]}),m&&e.jsxs(p,{onClick:m.onClick,variant:"outline",className:"gap-2",children:[m.icon,m.label]})]}),G&&u&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx(he,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"text-center",children:e.jsxs(b,{variant:"outline",className:"text-xs",children:["–í—Å–µ–≥–æ: ",u.totalItems]})}),e.jsx("div",{className:"text-center",children:e.jsxs(b,{variant:"outline",className:"text-xs",children:["–¢–∏–ø: ",u.dataType]})}),e.jsx("div",{className:"text-center",children:e.jsx(b,{variant:u.isArray?"default":"destructive",className:"text-xs",children:u.isArray?"–ú–∞—Å—Å–∏–≤":"–ù–µ –º–∞—Å—Å–∏–≤"})}),u.additionalInfo&&e.jsx("div",{className:"text-center",children:e.jsx(b,{variant:"secondary",className:"text-xs",children:u.additionalInfo})})]})]})]})})}const Ae={keitaro:{name:"Keitaro Tracker",tracker_type:"keitaro",endpoint_url:"https://your-keitaro-domain.com/api/v1/postback",method:"GET",params_template:{token:"{{auth_token}}",clickid:"{{clickid}}",status:"{{status}}",payout:"{{revenue}}",currency:"{{currency}}",country:"{{country_iso}}"},status_map:{lead:"lead",deposit:"sale",conversion:"sale",approved:"approved",hold:"hold",rejected:"rejected"}},binom:{name:"Binom Tracker",tracker_type:"custom",endpoint_url:"https://your-binom-domain.com/click.php",method:"GET",params_template:{cnv_id:"{{clickid}}",cnv_status:"{{status}}",payout:"{{revenue}}",currency:"{{currency}}",country:"{{country_iso}}"},statusMap:{lead:"1",deposit:"2",conversion:"2",approved:"3",hold:"4",rejected:"5"}},redtrack:{name:"RedTrack",trackerType:"custom",endpointUrl:"https://your-redtrack-domain.com/postback",method:"GET",paramsTemplate:{clickid:"{{clickid}}",goal:"{{status}}",revenue:"{{revenue}}",currency:"{{currency}}",country:"{{country_iso}}"},statusMap:{lead:"lead",deposit:"deposit",conversion:"sale",approved:"approved",hold:"pending",rejected:"rejected"}},voluum:{name:"Voluum",trackerType:"custom",endpointUrl:"https://your-voluum-domain.com/postback",method:"GET",paramsTemplate:{cid:"{{clickid}}",cv:"{{status}}",payout:"{{revenue}}",txid:"{{transaction_id}}",country:"{{country_iso}}"},statusMap:{lead:"1",deposit:"2",conversion:"2",approved:"3",hold:"4",rejected:"0"}},custom:{name:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç—Ä–µ–∫–µ—Ä",trackerType:"custom",endpointUrl:"",method:"GET",paramsTemplate:{clickid:"{{clickid}}",status:"{{status}}",revenue:"{{revenue}}",currency:"{{currency}}"},statusMap:{lead:"lead",deposit:"sale",conversion:"sale"}}},J={name:"",tracker_type:"custom",scope_type:"global",priority:100,enabled:!0,endpoint_url:"",method:"GET",id_param:"clickid",status_map:{open:"open",reg:"lead",deposit:"sale",lp_click:"click"},params_template:{clickid:"{{clickid}}",status:"{{status}}",revenue:"{{revenue}}",currency:"{{currency}}",country:"{{country_iso}}"},url_encode:!0,hmac_enabled:!1,retries:5,timeout_ms:4e3,backoff_base_sec:2,filter_revenue_gt0:!1,filter_country_whitelist:[],filter_country_blacklist:[],filter_exclude_bots:!0};function as(){const{t}=ge();x.useEffect(()=>{if(console.log("üîç –û–¢–õ–ê–î–ö–ê –¢–û–ö–ï–ù–û–í –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï:"),console.log("localStorage.token:",localStorage.getItem("token")),console.log("localStorage.auth_token:",localStorage.getItem("auth_token")),console.log("–í—Å–µ –∫–ª—é—á–∏ localStorage:",Object.keys(localStorage)),!(localStorage.getItem("token")||localStorage.getItem("auth_token"))){console.log("‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞...");const r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjA0YjA2Yzg3LWM2Y2YtNDQwOS1hZjY0LTNlMDViZjZjOWM3YyIsInVzZXJuYW1lIjoidGVzdF9hZmZpbGlhdGUiLCJyb2xlIjoiYWZmaWxpYXRlIiwiYWR2ZXJ0aXNlcklkIjpudWxsLCJpYXQiOjE3NTQ3Njg2NjIsImV4cCI6MTc1NDg1NTA2Mn0.GiEfmbEtVG5u-L0TN6RMgW3s3VkJMhULHG9Gn1VzNOc";localStorage.setItem("token",r),localStorage.setItem("auth_token",r),console.log("‚úÖ –¢–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")}},[]),me.useEffect(()=>{const s=window.fetch;return window.fetch=function(r,a){if(a&&a.method!==void 0&&(console.log("üîç FETCH CALL:",{url:String(r),method:a.method,methodType:typeof a.method,methodValue:JSON.stringify(a.method),stack:new Error().stack}),typeof a.method!="string")){console.error("‚ùå BAD METHOD TYPE:",{url:r,method:a.method,methodType:typeof a.method,fullInit:a,stack:new Error().stack});debugger;throw new Error(`Invalid method type: ${typeof a.method}. Expected string, got ${typeof a.method}`)}return s.call(this,r,a)},()=>{window.fetch=s}},[]);const[k,_]=x.useState(null),[E,m]=x.useState(!1),[u,w]=x.useState(!1),[G,y]=x.useState(!1),[U,ce]=x.useState("profiles"),[h,P]=x.useState({clickid:"",type:"reg",revenue:"100",currency:"USD"}),[ne,le]=x.useState("custom"),[ie,de]=x.useState(J),{toast:v}=je(),i=fe(),{data:n=[],isLoading:B,refetch:pe}=ee({queryKey:["/api/postback/profiles"],queryFn:async()=>{console.log("üîÑ Fetching profiles directly...");const s=await I("/api/postback/profiles","GET");return console.log("üìä Profiles received:",s),s||[]},refetchInterval:1e3,refetchOnWindowFocus:!0,staleTime:0,gcTime:0}),{data:D=[]}=ee({queryKey:["/api/postback/logs"]}),O=F({mutationFn:async s=>(console.log("Creating profile via apiRequest:",s),await I("/api/postback/profiles","POST",s)),onSuccess:()=>{i.removeQueries({queryKey:["/api/postback/profiles"]}),i.invalidateQueries({queryKey:["/api/postback/profiles"]}),i.refetchQueries({queryKey:["/api/postback/profiles"]}),m(!1),de(J),v({title:"–ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω",description:"–ü–æ—Å—Ç–±–µ–∫ –ø—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"}),setTimeout(()=>{i.refetchQueries({queryKey:["/api/postback/profiles"]})},100)},onError:s=>{console.error("Create mutation error:",s),v({title:"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è",description:s.message,variant:"destructive"})}}),C=F({mutationFn:async s=>{if(console.log("üîÑ Updating profile via apiRequest:",s),!s||typeof s!="object")throw new Error("Invalid profile data");const{id:r,...a}=s;if(!r)throw new Error("Profile ID is required");const c=await I(`/api/postback/profiles/${r}`,"PUT",a);return console.log("üîÑ Update result:",c),c},onSuccess:()=>{i.removeQueries({queryKey:["/api/postback/profiles"]}),i.invalidateQueries({queryKey:["/api/postback/profiles"]}),i.refetchQueries({queryKey:["/api/postback/profiles"]}),w(!1),_(null),v({title:"–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω",description:"–ü–æ—Å—Ç–±–µ–∫ –ø—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"})},onError:s=>{console.error("‚ùå Update mutation error:",s),v({title:"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",description:s.message,variant:"destructive"})}}),q=F({mutationFn:async s=>{if(console.log("üóëÔ∏è DELETE MUTATION - Starting deletion for:",s),!s)throw new Error("ID –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ —É–∫–∞–∑–∞–Ω");try{const r=await I(`/api/postback/profiles/${s}`,"DELETE");if(console.log("üóëÔ∏è DELETE MUTATION - apiRequest result:",r),!r||!r.success)throw new Error(r?.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏");return r}catch(r){throw console.error("üóëÔ∏è DELETE MUTATION - apiRequest error:",r),new Error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${r.message}`)}},onSuccess:s=>{console.log("üóëÔ∏è DELETE MUTATION - Success:",s),i.removeQueries({queryKey:["/api/postback/profiles"]}),i.invalidateQueries({queryKey:["/api/postback/profiles"]}),i.refetchQueries({queryKey:["/api/postback/profiles"]}),v({title:"–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ",description:"–ü—Ä–æ—Ñ–∏–ª—å –ø–æ—Å—Ç–±–µ–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã"}),setTimeout(()=>{i.refetchQueries({queryKey:["/api/postback/profiles"]})},500)},onError:s=>{console.error("üóëÔ∏è DELETE MUTATION - Error:",s),v({title:t("postbacks.deleteError","–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è"),description:`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å: ${s.message}`,variant:"destructive"})}}),g=F({mutationFn:async({profileId:s,testData:r})=>(console.log("Testing postback via apiRequest:",{profileId:s,testData:r}),await I(`/api/postback/test/${s}`,"POST",r)),onSuccess:s=>{v({title:s.success?t("postbacks.testSuccess","–¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω"):t("postbacks.testFailed","–¢–µ—Å—Ç –Ω–µ—É–¥–∞—á–µ–Ω"),description:s.message||t("postbacks.postbackSent","–ü–æ—Å—Ç–±–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")}),y(!1),i.invalidateQueries({queryKey:["/api/postback/logs"]})},onError:s=>{console.error("Test mutation error:",s),v({title:t("postbacks.testError","–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"),description:s.message,variant:"destructive"})}}),X=({profile:s,onSave:r})=>{const[a,c]=x.useState(s);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 p-4 bg-muted/50 rounded-lg",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[e.jsx(Re,{className:"h-4 w-4 text-blue-500"}),t("postbacks.quickSetup","–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ —à–∞–±–ª–æ–Ω—É")]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:Object.entries(Ae).map(([o,l])=>e.jsxs(p,{variant:ne===o?"default":"outline",size:"sm",onClick:()=>{le(o);const j={...J,...l,scope_type:"global"};c(j)},className:"h-auto p-3 flex flex-col items-center text-center","data-testid":`template-${o}`,children:[e.jsxs("div",{className:"font-medium text-xs mb-1",children:[o==="keitaro"&&"üî•",o==="binom"&&"‚ö°",o==="redtrack"&&"üöÄ",o==="voluum"&&"üìä",o==="custom"&&"‚öôÔ∏è"]}),e.jsx("div",{className:"text-xs",children:l.name})]},o))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("postbacks.templateHelp","–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–µ—Ä–æ–≤")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.name","–ù–∞–∑–≤–∞–Ω–∏–µ")}),e.jsx(T,{value:a.name||"",onChange:o=>c({...a,name:o.target.value}),placeholder:t("postbacks.placeholderName","–ú–æ–π —Ç—Ä–µ–∫–µ—Ä"),"data-testid":"input-profile-name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.trackerType","–¢–∏–ø —Ç—Ä–µ–∫–µ—Ä–∞")}),e.jsxs(L,{value:a.tracker_type,onValueChange:o=>c({...a,tracker_type:o}),children:[e.jsx(R,{"data-testid":"select-tracker-type",children:e.jsx(M,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"keitaro",children:"Keitaro"}),e.jsx(f,{value:"custom",children:t("postbacks.custom","–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.scope","–û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è")}),e.jsxs(L,{value:a.scope_type,onValueChange:o=>c({...a,scope_type:o}),children:[e.jsx(R,{"data-testid":"select-scope-type",children:e.jsx(M,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"global",children:t("postbacks.global","–ì–ª–æ–±–∞–ª—å–Ω–æ")}),e.jsx(f,{value:"offer",children:t("postbacks.offer","–û—Ñ—Ñ–µ—Ä")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.priority","–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç")}),e.jsx(T,{type:"number",value:a.priority||100,onChange:o=>c({...a,priority:parseInt(o.target.value)}),"data-testid":"input-priority"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:t("postbacks.endpointSettings","–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(d,{children:t("postbacks.endpointUrl","URL —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞")}),e.jsx(T,{value:a.endpoint_url||"",onChange:o=>c({...a,endpoint_url:o.target.value}),placeholder:t("postbacks.placeholderEndpoint","https://mytracker.com/postback"),"data-testid":"input-endpoint-url"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.method","–ú–µ—Ç–æ–¥")}),e.jsxs(L,{value:String(a.method||"GET"),onValueChange:o=>{console.log("Method select changed to:",o,typeof o),c({...a,method:o})},children:[e.jsx(R,{"data-testid":"select-method",children:e.jsx(M,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"GET",children:"GET"}),e.jsx(f,{value:"POST",children:"POST"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:t("postbacks.statusMapping","–ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(a.status_map||{}).map(([o,l])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:o}),e.jsx(T,{value:l,onChange:j=>c({...a,status_map:{...a.status_map,[o]:j.target.value}}),"data-testid":`input-status-${o}`})]},o))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:t("postbacks.paramsTemplate","–®–∞–±–ª–æ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")}),e.jsx(Se,{value:JSON.stringify(a.params_template||{},null,2),onChange:o=>{try{const l=JSON.parse(o.target.value);c({...a,params_template:l})}catch{}},className:"font-mono text-sm",rows:8,placeholder:`{
  "clickid": "{{clickid}}",
  "status": "{{status}}",
  "revenue": "{{revenue}}"
}`,"data-testid":"textarea-params-template"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>{m(!1),w(!1)},"data-testid":"button-cancel",children:t("common.cancel","–û—Ç–º–µ–Ω–∞")}),e.jsx(p,{onClick:()=>{console.log("Saving form data:",a);const o={...a,method:String(a.method||"GET")};console.log("Sanitized form data:",o),r(o)},disabled:!a.name||!a.endpoint_url,"data-testid":"button-save",children:t("common.save","–°–æ—Ö—Ä–∞–Ω–∏—Ç—å")})]})]})};return e.jsxs("div",{className:"p-6 space-y-6 bg-white min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t("postbacks.title","–ü–æ—Å—Ç–±–µ–∫–∏")}),e.jsx("p",{className:"text-muted-foreground",children:t("postbacks.subtitle","–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ç—Ä–µ–∫–µ—Ä–∞–º–∏")})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(p,{onClick:()=>{console.log("üß™ MANUAL TEST CREATE PROFILE");const s={name:`INTERFACE TEST ${Date.now()}`,tracker_type:"custom",endpoint_url:`http://test-interface.com/${Date.now()}`,method:"GET",enabled:!0};console.log("üß™ Creating profile:",s),O.mutate(s)},className:"bg-red-600 hover:bg-red-700 text-white","data-testid":"button-test-create",children:["üß™ ",t("postbacks.testProfile","–¢–ï–°–¢ –°–û–ó–î–ê–ù–ò–Ø")]}),e.jsxs("div",{className:"ml-4 p-3 bg-red-100 border-2 border-red-400 rounded text-sm font-bold",children:["‚ö†Ô∏è ",t("postbacks.refreshWarning","–ï–°–õ–ò –ö–ù–û–ü–ö–ò –ë–ï–õ–´–ï: –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5) –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à!")]}),e.jsxs(p,{onClick:()=>m(!0),"data-testid":"button-create-profile",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),t("postbacks.createProfile","–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å")]})]})]}),e.jsxs(we,{value:U,onValueChange:ce,children:[e.jsxs(Ce,{children:[e.jsx(ae,{value:"profiles",children:t("postbacks.profiles","–ü—Ä–æ—Ñ–∏–ª–∏")}),e.jsx(ae,{value:"logs",children:t("postbacks.deliveryLogs","–õ–æ–≥–∏ –¥–æ—Å—Ç–∞–≤–æ–∫")})]}),e.jsx(oe,{value:"profiles",className:"space-y-4",children:B?e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx(Z,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:t("postbacks.loading","–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π...")})]}):e.jsxs("div",{className:"grid gap-4",children:[console.log("üé® RENDERING PROFILES:",n),console.log("üé® PROFILES LENGTH:",n?.length),console.log("üé® PROFILES TYPE:",typeof n),console.log("üé® PROFILES ARRAY CHECK:",Array.isArray(n)),console.log("üé® MUTATIONS STATE:",{createPending:O.isPending,updatePending:C.isPending,deletePending:q.isPending,testPending:g.isPending}),n?.length>0?n.map((s,r)=>(console.log(`üé® RENDERING PROFILE #${r}:`,s),console.log(`üé® BUTTON STATES FOR ${s.id}:`,{deletePending:q.isPending,updatePending:C.isPending,testPending:g.isPending}),e.jsxs(W,{className:"hover:shadow-md transition-shadow border-4 border-green-500 bg-green-50",children:[e.jsx(se,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx(te,{className:"text-lg",children:s.name}),e.jsx(b,{variant:"outline",children:s.tracker_type})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(b,{variant:s.enabled?"default":"secondary",children:s.enabled?t("common.active","–í–∫–ª—é—á–µ–Ω"):t("common.disabled","–û—Ç–∫–ª—é—á–µ–Ω")})})]})}),e.jsxs(H,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("postbacks.endpoint","–≠–Ω–¥–ø–æ–∏–Ω—Ç")}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[s.method," ",s.endpoint_url]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t("postbacks.lastDelivery","–ü–æ—Å–ª–µ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.last_delivery?new Date(s.last_delivery).toLocaleString("ru-RU"):t("postbacks.never","–ù–µ –±—ã–ª–æ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{checked:s.enabled,onCheckedChange:a=>{console.log("Switch toggled:",a,"for profile:",s.id),C.mutate({...s,enabled:a})},"data-testid":`switch-enabled-${s.id}`}),e.jsx("span",{className:"text-sm",children:"–í–∫–ª—é—á–µ–Ω"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{_(s),P({clickid:`test_${Date.now()}`,type:"lead",revenue:"100",currency:"USD"}),y(!0)},disabled:g.isPending,title:"–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–±–µ–∫",className:g.isPending?"opacity-50 cursor-not-allowed":"","data-testid":`button-test-${s.id}`,children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),g.isPending?"–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...":"–¢–µ—Å—Ç"]}),e.jsxs("div",{onClick:()=>{console.log("üî• –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ù–ê–ñ–ê–¢–ê:",s.id),_(s),w(!0)},style:{background:"linear-gradient(45deg, #2563eb, #3b82f6)",color:"white",padding:"10px 20px",borderRadius:"8px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px",fontWeight:"bold",fontSize:"14px",border:"3px solid #2563eb",boxShadow:"0 4px 12px rgba(37, 99, 235, 0.3)",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.transform="scale(1.05)",a.currentTarget.style.boxShadow="0 6px 20px rgba(37, 99, 235, 0.5)"},onMouseLeave:a=>{a.currentTarget.style.transform="scale(1)",a.currentTarget.style.boxShadow="0 4px 12px rgba(37, 99, 235, 0.3)"},title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",children:[e.jsx(ke,{size:16}),C.isPending?"–ò–ó–ú–ï–ù–ï–ù–ò–ï...":"–ò–ó–ú–ï–ù–ò–¢–¨"]}),e.jsxs("button",{onClick:async a=>{a.preventDefault(),a.stopPropagation(),console.log("üö®üö®üö® –ü–†–û–°–¢–ï–ô–®–ê–Ø –ö–ù–û–ü–ö–ê –ù–ê–ñ–ê–¢–ê!"),console.log("üö® ID –ø—Ä–æ—Ñ–∏–ª—è:",s.id),console.log("üö® –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è:",s.name);const c=window.confirm(`–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å "${s.name}"?`);if(console.log("üö® –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",c),!c){console.log("üö® –û—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º");return}console.log("üö® –ù–∞—á–∏–Ω–∞–µ–º —É–¥–∞–ª–µ–Ω–∏–µ...");try{const o=localStorage.getItem("token")||localStorage.getItem("auth_token");if(console.log("üö® –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω:",o?"–î–ê":"–ù–ï–¢"),console.log("üö® –î–ª–∏–Ω–∞ —Ç–æ–∫–µ–Ω–∞:",o?.length||0),!o){alert("–û—à–∏–±–∫–∞: —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!");return}console.log("üö® –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å...");const l=await fetch(`/api/postback/profiles/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(console.log("üö® –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:",l.status),console.log("üö® OK:",l.ok),l.ok){const j=await l.json();console.log("üö® JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç:",j),alert(`‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${j.message}`),console.log("üö® –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É..."),window.location.reload()}else{const j=await l.text();console.error("üö® –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:",j),alert(`‚ùå –û—à–∏–±–∫–∞ ${l.status}: ${j}`)}}catch(o){console.error("üö® –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:",o),alert(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${o.message}`)}},style:{backgroundColor:"#ef4444",color:"#ffffff",border:"3px solid #dc2626",padding:"15px 30px",borderRadius:"10px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"10px",boxShadow:"0 6px 16px rgba(239, 68, 68, 0.4)",textTransform:"uppercase"},onMouseOver:a=>{a.currentTarget.style.backgroundColor="#dc2626",a.currentTarget.style.transform="scale(1.05)"},onMouseOut:a=>{a.currentTarget.style.backgroundColor="#ef4444",a.currentTarget.style.transform="scale(1)"},title:"–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å",children:[e.jsx(Oe,{size:20}),t("common.delete","–£–î–ê–õ–ò–¢–¨")]})]})]})]})]},s.id))):e.jsx(Me,{title:t("postbacks.noProfilesFound","–ü—Ä–æ—Ñ–∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"),description:t("postbacks.noProfilesDescription","–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–±–µ–∫–∞–º–∏"),action:{label:t("postbacks.createFirstProfile","–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"),onClick:()=>m(!0),icon:e.jsx(re,{className:"h-4 w-4"})},details:{totalItems:n?.length||0,dataType:typeof n,isArray:Array.isArray(n),additionalInfo:n===null?"null –¥–∞–Ω–Ω—ã–µ":n===void 0?"undefined –¥–∞–Ω–Ω—ã–µ":"–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"},onRefresh:()=>{console.log("üîÑ EmptyState: Forced refresh triggered",{timestamp:new Date().toISOString(),profilesLength:n?.length,profilesType:typeof n,isArray:Array.isArray(n),isLoading:B,mutationStates:{createPending:O.isPending,updatePending:C.isPending,deletePending:q.isPending,testPending:g.isPending}}),pe()}})]})}),e.jsx(oe,{value:"logs",className:"space-y-4",children:e.jsxs(W,{children:[e.jsxs(se,{children:[e.jsx(te,{children:t("postbacks.deliveryLogs","–õ–æ–≥–∏ –¥–æ—Å—Ç–∞–≤–æ–∫")}),e.jsx(ye,{children:t("postbacks.deliveryHistory","–ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å—Ç–±–µ–∫–æ–≤ –≤ —Ç—Ä–µ–∫–µ—Ä—ã")})]}),e.jsx(H,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_e,{children:[e.jsx(Pe,{children:e.jsxs(Y,{children:[e.jsx(S,{children:t("postbacks.time","–í—Ä–µ–º—è")}),e.jsx(S,{children:t("postbacks.profile","–ü—Ä–æ—Ñ–∏–ª—å")}),e.jsx(S,{children:"ClickID"}),e.jsx(S,{children:t("postbacks.status","–°—Ç–∞—Ç—É—Å")}),e.jsx(S,{children:t("postbacks.responseCode","–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞")}),e.jsx(S,{children:t("postbacks.attempt","–ü–æ–ø—ã—Ç–∫–∞")}),e.jsx(S,{children:t("postbacks.responseTime","–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞")})]})}),e.jsxs(Ie,{children:[Array.isArray(D)&&D.map(s=>e.jsxs(Y,{children:[e.jsx(N,{children:new Date(s.created_at).toLocaleString("ru-RU")}),e.jsx(N,{children:e.jsx(b,{variant:"outline",children:s.profile_name})}),e.jsx(N,{className:"font-mono text-sm",children:s.clickid}),e.jsx(N,{children:e.jsx(b,{variant:s.response_code>=200&&s.response_code<300?"default":"destructive",children:s.response_code>=200&&s.response_code<300?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),t("postbacks.success","–£—Å–ø–µ—Ö")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),t("postbacks.error","–û—à–∏–±–∫–∞")]})})}),e.jsx(N,{children:e.jsx(b,{variant:"outline",children:s.response_code||"N/A"})}),e.jsxs(N,{children:[s.attempt,"/",s.max_attempts]}),e.jsx(N,{children:s.duration_ms?`${s.duration_ms}ms`:"N/A"})]},s.id)),(!D||D.length===0)&&e.jsx(Y,{children:e.jsxs(N,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:[e.jsx(Le,{className:"h-8 w-8 mx-auto mb-2"}),t("postbacks.noLogsYet","–ü–æ–∫–∞ –Ω–µ—Ç –ª–æ–≥–æ–≤ –¥–æ—Å—Ç–∞–≤–æ–∫")]})})]})]})})})]})})]}),e.jsx($,{open:E,onOpenChange:m,children:e.jsxs(K,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsx(V,{children:t("postbacks.createProfileTitle","–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å")}),e.jsx(z,{children:t("postbacks.createProfileDescription","–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –≤–∞—à–∏–º —Ç—Ä–µ–∫–µ—Ä–æ–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–Ω–≤–µ—Ä—Å–∏—è—Ö")})]}),e.jsx(X,{profile:ie,onSave:s=>O.mutate(s)})]})}),e.jsx($,{open:u,onOpenChange:w,children:e.jsxs(K,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsx(V,{children:t("postbacks.editProfileTitle","–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å")}),e.jsx(z,{children:t("postbacks.editProfileDescription","–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ç—Ä–µ–∫–µ—Ä–æ–º")})]}),k&&e.jsx(X,{profile:k,onSave:s=>{console.log("PostbackForm onSave called with:",s),console.log("Selected profile:",k);const r={...k,...s};console.log("Final profile data:",r),C.mutate(r)}})]})}),e.jsx($,{open:G,onOpenChange:y,children:e.jsxs(K,{className:"max-w-2xl",children:[e.jsxs(Q,{children:[e.jsx(V,{children:t("postbacks.testTitle","–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–±–µ–∫–∞")}),e.jsx(z,{children:t("postbacks.testDescription","–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç–±–µ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.clickId","Click ID")}),e.jsx(T,{value:h.clickid,onChange:s=>P({...h,clickid:s.target.value}),placeholder:"test123456","data-testid":"input-test-clickid"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.eventType","–¢–∏–ø —Å–æ–±—ã—Ç–∏—è")}),e.jsxs(L,{value:h.type,onValueChange:s=>P({...h,type:s}),children:[e.jsx(R,{"data-testid":"select-test-type",children:e.jsx(M,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"lead",children:"Lead (–õ–∏–¥)"}),e.jsx(f,{value:"deposit",children:"Deposit (–î–µ–ø–æ–∑–∏—Ç)"}),e.jsx(f,{value:"conversion",children:"Conversion (–ö–æ–Ω–≤–µ—Ä—Å–∏—è)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.amount","–°—É–º–º–∞")}),e.jsx(T,{value:h.revenue,onChange:s=>P({...h,revenue:s.target.value}),placeholder:"100","data-testid":"input-test-revenue"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:t("postbacks.currency","–í–∞–ª—é—Ç–∞")}),e.jsx(T,{value:h.currency,onChange:s=>P({...h,currency:s.target.value}),placeholder:"USD","data-testid":"input-test-currency"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>y(!1),children:t("common.cancel","–û—Ç–º–µ–Ω–∞")}),e.jsxs(p,{onClick:()=>{k&&g.mutate({profileId:k.id,testData:h})},disabled:g.isPending||!h.clickid,children:[g.isPending?e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Te,{className:"h-4 w-4 mr-2"}),t("postbacks.sendTest","–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç")]})]})]})]})})]})}export{as as AffiliatePostbacks,as as default};
