import{j as e}from"./ui-CkQMVfNu.js";import{r as O}from"./vendor-DazevGLP.js";import{u as xe,d as he,r as je,B as g,C as N,g as f,v as ue,w as pe,n as ge,N as Z,e as I,f as F,L as n,I as u,h as W,i as J,j as V,k as H,l as m,o as j,y as d,O as Ne}from"./index-Hu68kGEe.js";import{u as ee}from"./useQuery-IUx4ZSsA.js";import{u as U}from"./useMutation-HxEtoRum.js";import{B as P}from"./badge-BPEJ7H1K.js";import{T as fe,a as ve,b as K,c as Q}from"./tabs-BOkB6Db_.js";import{S as b}from"./switch-BurhKlWt.js";import{D as we,a as be,b as ye,c as ke}from"./dialog-CMra4o9L.js";import{T as _,a as G,b as o,c,d as X,e as a}from"./table-D9zFYVHJ.js";import{T as Ce}from"./textarea-DGF4QzFC.js";import{P as Se}from"./plus-CDknCoO7.js";import{D as Te}from"./download-BE2ywTvs.js";import{F as Oe}from"./filter-DkQgzo_M.js";import{S as Re}from"./search-w8xkMBVR.js";import{C as Ae}from"./clock-HOqnpwZm.js";import{S as Le}from"./square-pen-DvrE7Sss.js";import{T as Ee}from"./trash-2-BgkAOTI8.js";import{A as Ie}from"./activity-aTdJAE09.js";import"./utils-B-_CankM.js";const Y={manager:{manageOffers:!0,managePartners:!0,viewStatistics:!0,financialOperations:!1,postbacksApi:!1},analyst:{manageOffers:!1,managePartners:!1,viewStatistics:!0,financialOperations:!1,postbacksApi:!1},financier:{manageOffers:!1,managePartners:!1,viewStatistics:!1,financialOperations:!0,postbacksApi:!1},support:{manageOffers:!0,managePartners:!1,viewStatistics:!0,financialOperations:!1,postbacksApi:!0}},se={manager:"Менеджер",analyst:"Аналитик",financier:"Финансист",support:"Техподдержка"},Fe={manager:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",analyst:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",financier:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",support:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300"};function as(){const{user:S}=xe(),{toast:p}=he(),D=je(),[te,ae]=O.useState("members"),[ie,R]=O.useState(!1),[y,A]=O.useState(null),[h,B]=O.useState({search:"",role:"all",status:"all"}),[i,l]=O.useState({username:"",email:"",firstName:"",lastName:"",role:"manager",permissions:Y.manager,restrictions:{ipWhitelist:[],geoRestrictions:[],timeRestrictions:{enabled:!1,startTime:"09:00",endTime:"18:00",timezone:"UTC",workingDays:[1,2,3,4,5]}},telegramNotifications:!1,telegramUserId:""}),{data:k=[],isLoading:re,refetch:ne,error:Ue}=ee({queryKey:["/api/advertiser/team/members",S?.id],queryFn:async()=>{const s=await fetch("/api/advertiser/team/members",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Ошибка загрузки команды");return s.json()},enabled:!!S?.id}),{data:L=[],isLoading:le,error:Pe}=ee({queryKey:["/api/advertiser/team/activity-logs",S?.id],queryFn:async()=>{const s=await fetch("/api/advertiser/team/activity-logs",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Ошибка загрузки логов");return s.json()},enabled:!!S?.id}),M=U({mutationFn:async s=>{const t=await fetch("/api/advertiser/team/invite",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(s)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Ошибка отправки приглашения")}return t.json()},onSuccess:s=>{p({title:"Приглашение отправлено",description:`Email-приглашение отправлено на ${s.email}`}),ne()},onError:s=>{p({title:"Ошибка отправки приглашения",description:s.message,variant:"destructive"})}}),$=U({mutationFn:async s=>{const t=await fetch("/api/advertiser/team/members",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(s)});if(!t.ok)throw new Error("Ошибка создания сотрудника");return t.json()},onSuccess:()=>{D.invalidateQueries({queryKey:["/api/advertiser/team/members"]}),R(!1),E(),p({title:"Сотрудник добавлен",description:"Новый сотрудник успешно добавлен в команду"})},onError:s=>{p({title:"Ошибка добавления",description:s.message,variant:"destructive"})}}),z=U({mutationFn:async({id:s,data:t})=>{const r=await fetch(`/api/advertiser/team/members/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)});if(!r.ok)throw new Error("Ошибка обновления сотрудника");return r.json()},onSuccess:()=>{D.invalidateQueries({queryKey:["/api/advertiser/team/members"]}),A(null),E(),p({title:"Данные обновлены",description:"Информация о сотруднике успешно обновлена"})}}),ce=U({mutationFn:async s=>{const t=await fetch(`/api/advertiser/team/members/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Ошибка удаления сотрудника");return t.json()},onSuccess:()=>{D.invalidateQueries({queryKey:["/api/advertiser/team/members"]}),p({title:"Сотрудник удалён",description:"Сотрудник успешно удалён из команды"})}}),de=()=>{if(!i.email||!i.role){p({title:"Ошибка валидации",description:"Email и роль обязательны для заполнения",variant:"destructive"});return}M.mutate({email:i.email,role:i.role})},oe=(s="csv")=>{const t=k.map(r=>({email:r.email,name:`${r.firstName} ${r.lastName}`,role:se[r.role],status:r.status,lastActivity:r.lastActivity,createdAt:r.createdAt}));if(s==="json"){const r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),v=URL.createObjectURL(r),w=document.createElement("a");w.href=v,w.download=`team-members-${new Date().toISOString().split("T")[0]}.json`,w.click()}else{const v=[["Email","Name","Role","Status","Last Activity","Added Date"].join(","),...t.map(C=>[C.email,C.name,C.role,C.status,C.lastActivity,C.createdAt].join(","))].join(`
`),w=new Blob([v],{type:"text/csv"}),T=URL.createObjectURL(w),x=document.createElement("a");x.href=T,x.download=`team-members-${new Date().toISOString().split("T")[0]}.csv`,x.click()}p({title:"Экспорт завершен",description:`Данные команды экспортированы в формате ${s.toUpperCase()}`})},E=()=>{l({username:"",email:"",firstName:"",lastName:"",role:"manager",permissions:Y.manager,restrictions:{ipWhitelist:[],geoRestrictions:[],timeRestrictions:{enabled:!1,startTime:"09:00",endTime:"18:00",timezone:"UTC",workingDays:[1,2,3,4,5]}},telegramNotifications:!1,telegramUserId:""})},me=s=>{l(t=>({...t,role:s,permissions:Y[s]}))},q=k.filter(s=>{const t=s.username.toLowerCase().includes(h.search.toLowerCase())||s.email.toLowerCase().includes(h.search.toLowerCase())||`${s.firstName} ${s.lastName}`.toLowerCase().includes(h.search.toLowerCase()),r=h.role==="all"||s.role===h.role,v=h.status==="all"||s.status===h.status;return t&&r&&v});return S?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Командный режим"}),e.jsx("p",{className:"text-muted-foreground",children:"Управление командой и разграничение прав доступа"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(g,{onClick:()=>R(!0),"data-testid":"button-add-member",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Добавить сотрудника"]}),e.jsxs(g,{variant:"outline",onClick:()=>oe("csv"),"data-testid":"button-export-team",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Экспорт"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(N,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-700 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-full",children:e.jsx(ue,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"👤 Всего сотрудников"}),e.jsx("p",{className:"text-3xl font-bold text-blue-800 dark:text-blue-200",children:k.length})]})]})})}),e.jsx(N,{className:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-700 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full",children:e.jsx(pe,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"✅ Активных"}),e.jsx("p",{className:"text-3xl font-bold text-green-800 dark:text-green-200",children:k.filter(s=>s.status==="active").length})]})]})})}),e.jsx(N,{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-purple-200 dark:border-purple-700 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full",children:e.jsx(ge,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"🔒 С ограничениями"}),e.jsx("p",{className:"text-3xl font-bold text-purple-800 dark:text-purple-200",children:k.filter(s=>s.restrictions.ipWhitelist.length>0||s.restrictions.geoRestrictions.length>0||s.restrictions.timeRestrictions.enabled).length})]})]})})}),e.jsx(N,{className:"bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 border-orange-200 dark:border-orange-700 shadow-lg hover:shadow-xl transition-shadow",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-orange-500 to-red-500 rounded-full",children:e.jsx(Z,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"🔔 Telegram уведомления"}),e.jsx("p",{className:"text-3xl font-bold text-orange-800 dark:text-orange-200",children:k.filter(s=>s.telegramNotifications).length})]})]})})})]}),e.jsxs(fe,{value:te,onValueChange:ae,className:"space-y-4",children:[e.jsxs(ve,{className:"bg-gradient-to-r from-slate-100 to-gray-100 dark:from-slate-800 dark:to-gray-800 p-1 rounded-xl",children:[e.jsx(K,{value:"members",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-indigo-500 data-[state=active]:text-white",children:"👥 Сотрудники"}),e.jsx(K,{value:"roles",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-500 data-[state=active]:to-pink-500 data-[state=active]:text-white",children:"🔑 Роли и права"}),e.jsx(K,{value:"activity",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-500 data-[state=active]:text-white",children:"📋 Логи действий"})]}),e.jsxs(Q,{value:"members",className:"space-y-4",children:[e.jsxs(N,{children:[e.jsx(I,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Фильтры сотрудников"]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"search",children:"Поиск"}),e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(u,{id:"search",placeholder:"Имя, email, username...",value:h.search,onChange:s=>B(t=>({...t,search:s.target.value})),className:"pl-8","data-testid":"input-search-members"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Роль"}),e.jsxs(W,{value:h.role,onValueChange:s=>B(t=>({...t,role:s})),children:[e.jsx(J,{"data-testid":"select-role-filter",children:e.jsx(V,{placeholder:"Все роли"})}),e.jsxs(H,{children:[e.jsx(m,{value:"all",children:"Все роли"}),e.jsx(m,{value:"manager",children:"Менеджер"}),e.jsx(m,{value:"analyst",children:"Аналитик"}),e.jsx(m,{value:"financier",children:"Финансист"}),e.jsx(m,{value:"support",children:"Техподдержка"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Статус"}),e.jsxs(W,{value:h.status,onValueChange:s=>B(t=>({...t,status:s})),children:[e.jsx(J,{"data-testid":"select-status-filter",children:e.jsx(V,{placeholder:"Все статусы"})}),e.jsxs(H,{children:[e.jsx(m,{value:"all",children:"Все статусы"}),e.jsx(m,{value:"active",children:"Активный"}),e.jsx(m,{value:"inactive",children:"Неактивный"}),e.jsx(m,{value:"blocked",children:"Заблокирован"})]})]})]})]})})]}),e.jsxs(N,{children:[e.jsx(I,{children:e.jsxs(F,{children:["Список сотрудников (",q.length,")"]})}),e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_,{children:[e.jsx(G,{children:e.jsxs(o,{children:[e.jsx(c,{children:"Сотрудник"}),e.jsx(c,{children:"Роль"}),e.jsx(c,{children:"Статус"}),e.jsx(c,{children:"Последняя активность"}),e.jsx(c,{children:"Уведомления"}),e.jsx(c,{children:"Действия"})]})}),e.jsx(X,{children:re?e.jsx(o,{children:e.jsx(a,{colSpan:6,className:"text-center",children:"Загрузка..."})}):q.length===0?e.jsx(o,{children:e.jsx(a,{colSpan:6,className:"text-center",children:"Сотрудники не найдены"})}):q.map(s=>e.jsxs(o,{children:[e.jsx(a,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["@",s.username," • ",s.email]})]})}),e.jsx(a,{children:e.jsx(P,{className:Fe[s.role],children:se[s.role]})}),e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="active"&&e.jsx(j,{className:"h-4 w-4 text-green-500"}),s.status==="inactive"&&e.jsx(Ae,{className:"h-4 w-4 text-yellow-500"}),s.status==="blocked"&&e.jsx(d,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"capitalize",children:s.status})]})}),e.jsx(a,{children:e.jsx("div",{className:"text-sm",children:new Date(s.lastActivity).toLocaleString("ru-RU")})}),e.jsx(a,{children:s.telegramNotifications?e.jsxs(P,{variant:"outline",className:"text-green-600",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Включены"]}):e.jsx(P,{variant:"outline",className:"text-gray-500",children:"Отключены"})}),e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{A(s),l({username:s.username,email:s.email,firstName:s.firstName,lastName:s.lastName,role:s.role,permissions:s.permissions,restrictions:s.restrictions,telegramNotifications:s.telegramNotifications,telegramUserId:s.telegramUserId||""})},"data-testid":`button-edit-member-${s.id}`,children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>ce.mutate(s.id),"data-testid":`button-delete-member-${s.id}`,children:e.jsx(Ee,{className:"h-4 w-4 text-red-500"})})]})})]},s.id))})]})})})]})]}),e.jsx(Q,{value:"roles",className:"space-y-4",children:e.jsxs(N,{children:[e.jsxs(I,{children:[e.jsx(F,{children:"Таблица ролей и разрешений"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Права доступа для каждой роли в системе"})]}),e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_,{children:[e.jsx(G,{children:e.jsxs(o,{children:[e.jsx(c,{className:"w-[200px]",children:"Функция"}),e.jsx(c,{className:"text-center",children:"Менеджер"}),e.jsx(c,{className:"text-center",children:"Аналитик"}),e.jsx(c,{className:"text-center",children:"Финансист"}),e.jsx(c,{className:"text-center",children:"Техподдержка"})]})}),e.jsxs(X,{children:[e.jsxs(o,{children:[e.jsx(a,{className:"font-medium",children:"Управление офферами"}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})})]}),e.jsxs(o,{children:[e.jsx(a,{className:"font-medium",children:"Управление партнёрами"}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})})]}),e.jsxs(o,{children:[e.jsx(a,{className:"font-medium",children:"Просмотр статистики"}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})})]}),e.jsxs(o,{children:[e.jsx(a,{className:"font-medium",children:"Финансовые операции"}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})})]}),e.jsxs(o,{children:[e.jsx(a,{className:"font-medium",children:"Постбеки и API"}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(d,{className:"h-5 w-5 text-red-500 mx-auto"})}),e.jsx(a,{className:"text-center",children:e.jsx(j,{className:"h-5 w-5 text-green-500 mx-auto"})})]})]})]})})})]})}),e.jsx(Q,{value:"activity",className:"space-y-4",children:e.jsxs(N,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Логи действий команды"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"История действий всех сотрудников команды"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{const s=L.map(x=>({timestamp:new Date(x.timestamp).toLocaleString("ru-RU"),username:x.username,action:x.action,resource:x.resource,ipAddress:x.ipAddress,result:x.result})),r=[["Время","Пользователь","Действие","Ресурс","IP адрес","Результат"].join(","),...s.map(x=>Object.values(x).join(","))].join(`
`),v=new Blob([r],{type:"text/csv"}),w=URL.createObjectURL(v),T=document.createElement("a");T.href=w,T.download=`team-activity-logs-${new Date().toISOString().split("T")[0]}.csv`,T.click()},children:"Экспорт CSV"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{const s=new Blob([JSON.stringify(L,null,2)],{type:"application/json"}),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=`team-activity-logs-${new Date().toISOString().split("T")[0]}.json`,r.click()},children:"Экспорт JSON"})]})]})}),e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_,{children:[e.jsx(G,{children:e.jsxs(o,{children:[e.jsx(c,{children:"Время"}),e.jsx(c,{children:"Пользователь"}),e.jsx(c,{children:"Действие"}),e.jsx(c,{children:"Ресурс"}),e.jsx(c,{children:"IP адрес"}),e.jsx(c,{children:"Результат"})]})}),e.jsx(X,{children:le?e.jsx(o,{children:e.jsx(a,{colSpan:6,className:"text-center",children:"Загрузка логов..."})}):L.length===0?e.jsx(o,{children:e.jsx(a,{colSpan:6,className:"text-center",children:"Логи активности не найдены"})}):L.slice(0,50).map(s=>e.jsxs(o,{children:[e.jsx(a,{children:e.jsx("div",{className:"text-sm",children:new Date(s.timestamp).toLocaleString("ru-RU")})}),e.jsx(a,{children:e.jsx("div",{className:"font-medium",children:s.username})}),e.jsx(a,{children:e.jsx(P,{variant:"outline",children:s.action})}),e.jsx(a,{children:s.resource}),e.jsx(a,{children:e.jsx("code",{className:"text-xs",children:s.ipAddress})}),e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.result==="success"&&e.jsx(j,{className:"h-4 w-4 text-green-500"}),s.result==="failed"&&e.jsx(d,{className:"h-4 w-4 text-red-500"}),s.result==="warning"&&e.jsx(Ne,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"capitalize text-sm",children:s.result})]})})]},s.id))})]})})})]})})]}),e.jsx(we,{open:ie||!!y,onOpenChange:s=>{s||(R(!1),A(null),E())},children:e.jsxs(be,{className:"max-w-4xl max-h-[80vh] overflow-y-auto","aria-describedby":"team-member-dialog-description",children:[e.jsx(ye,{children:e.jsx(ke,{children:y?"Редактировать сотрудника":"Добавить сотрудника"})}),e.jsxs("div",{id:"team-member-dialog-description",className:"sr-only",children:["Форма для ",y?"редактирования данных":"добавления нового"," сотрудника в команду с настройкой ролей и разрешений"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Основная информация"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"username",children:"Username *"}),e.jsx(u,{id:"username",value:i.username,onChange:s=>l(t=>({...t,username:s.target.value})),placeholder:"username","data-testid":"input-member-username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(u,{id:"email",type:"email",value:i.email,onChange:s=>l(t=>({...t,email:s.target.value})),placeholder:"user@example.com","data-testid":"input-member-email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"firstName",children:"Имя *"}),e.jsx(u,{id:"firstName",value:i.firstName,onChange:s=>l(t=>({...t,firstName:s.target.value})),placeholder:"Иван","data-testid":"input-member-firstname"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"lastName",children:"Фамилия *"}),e.jsx(u,{id:"lastName",value:i.lastName,onChange:s=>l(t=>({...t,lastName:s.target.value})),placeholder:"Иванов","data-testid":"input-member-lastname"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Роль и права доступа"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Роль"}),e.jsxs(W,{value:i.role,onValueChange:me,children:[e.jsx(J,{"data-testid":"select-member-role",children:e.jsx(V,{})}),e.jsxs(H,{children:[e.jsx(m,{value:"manager",children:"Менеджер"}),e.jsx(m,{value:"analyst",children:"Аналитик"}),e.jsx(m,{value:"financier",children:"Финансист"}),e.jsx(m,{value:"support",children:"Техподдержка"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{children:"Разрешения"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{htmlFor:"manageOffers",className:"text-sm",children:"Управление офферами"}),e.jsx(b,{id:"manageOffers",checked:i.permissions.manageOffers,onCheckedChange:s=>l(t=>({...t,permissions:{...t.permissions,manageOffers:s}})),"data-testid":"switch-manage-offers"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{htmlFor:"managePartners",className:"text-sm",children:"Управление партнёрами"}),e.jsx(b,{id:"managePartners",checked:i.permissions.managePartners,onCheckedChange:s=>l(t=>({...t,permissions:{...t.permissions,managePartners:s}})),"data-testid":"switch-manage-partners"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{htmlFor:"viewStatistics",className:"text-sm",children:"Просмотр статистики"}),e.jsx(b,{id:"viewStatistics",checked:i.permissions.viewStatistics,onCheckedChange:s=>l(t=>({...t,permissions:{...t.permissions,viewStatistics:s}})),"data-testid":"switch-view-statistics"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{htmlFor:"financialOperations",className:"text-sm",children:"Финансовые операции"}),e.jsx(b,{id:"financialOperations",checked:i.permissions.financialOperations,onCheckedChange:s=>l(t=>({...t,permissions:{...t.permissions,financialOperations:s}})),"data-testid":"switch-financial-operations"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{htmlFor:"postbacksApi",className:"text-sm",children:"Постбеки и API"}),e.jsx(b,{id:"postbacksApi",checked:i.permissions.postbacksApi,onCheckedChange:s=>l(t=>({...t,permissions:{...t.permissions,postbacksApi:s}})),"data-testid":"switch-postbacks-api"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Ограничения доступа"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"ipWhitelist",children:"IP белый список (через запятую)"}),e.jsx(Ce,{id:"ipWhitelist",value:i.restrictions.ipWhitelist.join(", "),onChange:s=>l(t=>({...t,restrictions:{...t.restrictions,ipWhitelist:s.target.value.split(",").map(r=>r.trim()).filter(Boolean)}})),placeholder:"192.168.1.1, 10.0.0.1","data-testid":"textarea-ip-whitelist"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"geoRestrictions",children:"GEO ограничения (коды стран через запятую)"}),e.jsx(u,{id:"geoRestrictions",value:i.restrictions.geoRestrictions.join(", "),onChange:s=>l(t=>({...t,restrictions:{...t.restrictions,geoRestrictions:s.target.value.split(",").map(r=>r.trim()).filter(Boolean)}})),placeholder:"RU, US, DE","data-testid":"input-geo-restrictions"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{children:"Временные ограничения"}),e.jsx(b,{checked:i.restrictions.timeRestrictions.enabled,onCheckedChange:s=>l(t=>({...t,restrictions:{...t.restrictions,timeRestrictions:{...t.restrictions.timeRestrictions,enabled:s}}})),"data-testid":"switch-time-restrictions"})]}),i.restrictions.timeRestrictions.enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pl-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"startTime",children:"Начало работы"}),e.jsx(u,{id:"startTime",type:"time",value:i.restrictions.timeRestrictions.startTime,onChange:s=>l(t=>({...t,restrictions:{...t.restrictions,timeRestrictions:{...t.restrictions.timeRestrictions,startTime:s.target.value}}})),"data-testid":"input-start-time"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"endTime",children:"Конец работы"}),e.jsx(u,{id:"endTime",type:"time",value:i.restrictions.timeRestrictions.endTime,onChange:s=>l(t=>({...t,restrictions:{...t.restrictions,timeRestrictions:{...t.restrictions.timeRestrictions,endTime:s.target.value}}})),"data-testid":"input-end-time"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Telegram уведомления"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{htmlFor:"telegramNotifications",children:"Включить Telegram уведомления"}),e.jsx(b,{id:"telegramNotifications",checked:i.telegramNotifications,onCheckedChange:s=>l(t=>({...t,telegramNotifications:s})),"data-testid":"switch-telegram-notifications"})]}),i.telegramNotifications&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"telegramUserId",children:"Telegram User ID"}),e.jsx(u,{id:"telegramUserId",value:i.telegramUserId,onChange:s=>l(t=>({...t,telegramUserId:s.target.value})),placeholder:"123456789","data-testid":"input-telegram-user-id"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(g,{variant:"outline",onClick:()=>{R(!1),A(null),E()},"data-testid":"button-cancel-member",children:"Отмена"}),e.jsxs(g,{onClick:()=>{y?z.mutate({id:y.id,_data:i}):i.username&&i.firstName&&i.lastName?$.mutate(i):de()},disabled:$.isPending||z.isPending||M.isPending,"data-testid":"button-save-member",children:[($.isPending||z.isPending||M.isPending)&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),y?"Сохранить":i.username?"Добавить":"Пригласить"]})]})]})]})})]}):e.jsx("div",{children:"Загрузка..."})}export{as as default};
