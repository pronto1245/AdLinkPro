import{j as e}from"./ui-CkQMVfNu.js";import{r as m}from"./vendor-DazevGLP.js";import{u as E}from"./useQuery-qpsyHy1X.js";import{c as A,d as F,r as P,L as M,B as c,$ as Q,K as V,C as x,g as u,I as _,h as T,i as $,j as L,k as D,l as r,T as K,D as H,x as G}from"./index-BiZ3ky40.js";import{T as J,a as U,b as R,c as h,d as W,e as j}from"./table-BX93bJ8w.js";import{B as X}from"./badge-B53pzHyE.js";import{D as Y,a as Z,b as ee,c as I}from"./dropdown-menu-DAFb98Up.js";import{g as se,f as te}from"./countries-CXfsfsz6.js";import{f as ae}from"./formatting-XXeiCqNP.js";import{D as ie,a as re,b as le,c as ce,d as ne,f as de}from"./dialog-BZ5LljxY.js";import{T as O}from"./textarea-C_vyxygv.js";import{u as oe}from"./useMutation-21NtthE3.js";import{a as me}from"./queryClient-DKT_jxev.js";import{S as xe}from"./search-DDN-WbhH.js";import{C as z}from"./copy-C8LLNJY1.js";import{C as ue}from"./clock-BdukKcj2.js";import"./utils-B-_CankM.js";import"./chevron-right-BtbKE9C9.js";import"./smartphone-BshVV02M.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=A("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=A("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function pe({isOpen:d,onClose:w,offer:a}){const[v,l]=m.useState(""),[N,p]=m.useState(""),{toast:g}=F(),y=P(),o=oe({mutationFn:async t=>{await me(`/api/offers/${t.offerId}/request-access`,"POST",{requestNote:t.requestNote,partnerMessage:t.partnerMessage})},onSuccess:()=>{g({title:"Запрос отправлен",description:"Ваш запрос на доступ к офферу был отправлен рекламодателю"}),y.invalidateQueries({queryKey:["/api/partner/offers"]}),y.invalidateQueries({queryKey:["/api/partner/access-requests"]}),i()},onError:t=>{const C=t.message||"Ошибка при отправке запроса";g({title:"Ошибка",description:C,variant:"destructive"})}}),b=t=>{t.preventDefault(),a?.id&&o.mutate({offerId:a.id,requestNote:v.trim()||void 0,partnerMessage:N.trim()||void 0})},i=()=>{l(""),p(""),w()};return e.jsx(ie,{open:d,onOpenChange:i,children:e.jsxs(re,{className:"sm:max-w-[500px]","data-testid":"modal-request-access",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Запросить доступ к офферу"}),e.jsx(ne,{children:"Отправьте запрос рекламодателю для получения полного доступа к офферу с ссылками лендингов"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg border p-4 bg-muted/50",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2","data-testid":"text-offer-name",children:a.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Рекламодатель:"}),e.jsxs("div",{className:"font-medium","data-testid":"text-advertiser-name",children:[a.advertiser_name,a.advertiser_company&&e.jsxs("span",{className:"text-muted-foreground",children:[" (",a.advertiser_company,")"]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Выплата:"}),e.jsxs("div",{className:"font-medium","data-testid":"text-offer-payout",children:[a.payout," ",a.currency]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Категория:"}),e.jsx("div",{className:"font-medium","data-testid":"text-offer-category",children:a.category})]})]})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"partnerMessage",children:"Сообщение рекламодателю"}),e.jsx(O,{id:"partnerMessage",placeholder:"Расскажите о себе, ваших источниках трафика и планах по продвижению оффера...",value:N,onChange:t=>p(t.target.value),rows:4,"data-testid":"textarea-partner-message"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"requestNote",children:"Дополнительная информация"}),e.jsx(O,{id:"requestNote",placeholder:"Укажите дополнительные детали или вопросы по офферу...",value:v,onChange:t=>l(t.target.value),rows:3,"data-testid":"textarea-request-note"})]}),e.jsxs(de,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:i,disabled:o.isPending,"data-testid":"button-cancel-request",children:"Отмена"}),e.jsxs(c,{type:"submit",disabled:o.isPending||!a?.id,"data-testid":"button-submit-request",children:[o.isPending&&e.jsx(Q,{className:"w-4 h-4 mr-2 animate-spin"}),"Отправить запрос"]})]})]})]})]})})}function ze(){const[d,w]=m.useState(""),[a,v]=m.useState("all-categories"),[l,N]=m.useState("all"),[p,g]=m.useState(null),[y,o]=m.useState(!1),{toast:b}=F(),{t:i}=V();P();const{data:t=[],isLoading:C}=E({queryKey:["/api/partner/offers"]}),k=t.filter(s=>{const n=!d||s.name?.toLowerCase().includes(d.toLowerCase())||s.advertiser_name?.toLowerCase().includes(d.toLowerCase()),S=a==="all-categories"||s.category?.toLowerCase().includes(a.toLowerCase()),B=l==="all"||l==="approved"&&s.hasFullAccess||l==="pending"&&s.accessStatus==="pending"||l==="available"&&s.accessStatus==="available"||l==="rejected"&&s.accessStatus==="rejected";return n&&S&&B}),q=(s,n)=>{navigator.clipboard.writeText(s),b({title:i("common.copied"),description:`${n} ${i("common.copiedToClipboard")}`})},f=s=>{g(s),o(!0)};return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"Загрузка офферов..."})}):e.jsxs("div",{className:"space-y-6 w-full","data-testid":"page-partner-offers",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Доступные офферы"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Просматривайте и запрашивайте доступ к офферам"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.filter(s=>s.hasFullAccess).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Доступно"})]})}),e.jsx(x,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:t.filter(s=>s.accessStatus==="pending").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ожидают ответа"})]})}),e.jsx(x,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.filter(s=>s.accessStatus==="rejected").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Отклонено"})]})}),e.jsx(x,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:t.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Всего офферов"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:"Поиск по названию оффера или рекламодателю...",value:d,onChange:s=>w(s.target.value),className:"pl-8","data-testid":"input-search"})]})}),e.jsxs(T,{value:a,onValueChange:v,children:[e.jsx($,{className:"w-full sm:w-[180px]","data-testid":"select-category",children:e.jsx(L,{placeholder:"Категория"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all-categories",children:"Все категории"}),e.jsx(r,{value:"gambling",children:"Гемблинг"}),e.jsx(r,{value:"dating",children:"Знакомства"}),e.jsx(r,{value:"finance",children:"Финансы"}),e.jsx(r,{value:"crypto",children:"Крипто"}),e.jsx(r,{value:"nutra",children:"Нутра"}),e.jsx(r,{value:"software",children:"ПО"})]})]}),e.jsxs(T,{value:l,onValueChange:N,children:[e.jsx($,{className:"w-full sm:w-[180px]","data-testid":"select-access",children:e.jsx(L,{placeholder:"Статус доступа"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"Все"}),e.jsx(r,{value:"approved",children:"Доступны"}),e.jsx(r,{value:"pending",children:"Ожидание"}),e.jsx(r,{value:"available",children:"Можно запросить"}),e.jsx(r,{value:"rejected",children:"Отклонено"})]})]})]}),e.jsx(x,{children:e.jsx(u,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{children:[e.jsx(U,{children:e.jsxs(R,{children:[e.jsx(h,{children:"Оффер"}),e.jsx(h,{children:"Категория"}),e.jsx(h,{children:"Гео"}),e.jsx(h,{children:"Сумма"}),e.jsx(h,{children:"CR"}),e.jsx(h,{className:"text-right",children:"Действия"})]})}),e.jsx(W,{children:k.map(s=>{const n=se(s.category);return e.jsxs(R,{"data-testid":`row-offer-${s.id}`,children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.logo?e.jsx("img",{src:s.logo,alt:s.name,className:"w-10 h-10 rounded object-cover flex-shrink-0",onError:S=>{S.currentTarget.style.display="none"}}):e.jsx("div",{className:"w-10 h-10 rounded bg-gray-200 flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium","data-testid":`text-offer-name-${s.id}`,children:s.name}),s.advertiser_name&&e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.advertiser_name})]})]})}),e.jsx(j,{children:e.jsxs(X,{className:n?.className||"bg-gray-100 text-gray-800","data-testid":`badge-category-${s.id}`,children:[n?.icon&&e.jsx(n.icon,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n?.label||s.category})]})}),e.jsx(j,{children:e.jsx("div",{className:"text-sm min-w-0",children:e.jsx("span",{className:"truncate block",children:te(s.countries)})})}),e.jsx(j,{children:e.jsxs("div",{className:"font-mono font-medium whitespace-nowrap",children:[s.payout," ",s.currency]})}),e.jsx(j,{children:e.jsxs("div",{className:"font-mono text-green-600 font-medium whitespace-nowrap",children:[ae(s.cr||0),"%"]})}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.accessStatus==="approved"&&s.trackingLink?e.jsxs(c,{size:"sm",variant:"default",onClick:()=>q(s.trackingLink,"Готовая ссылка"),title:"Скопировать готовую ссылку с clickid","data-testid":`button-copy-tracking-${s.id}`,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Готовая ссылка"]}):s.accessStatus==="approved"?e.jsxs(c,{size:"sm",variant:"default",onClick:()=>q(s.partnerLink||`${window.location.origin}/offers/${s.id}`,"Ссылка на оффер"),title:"Копировать ссылку","data-testid":`button-copy-${s.id}`,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Получить ссылку"]}):s.accessStatus==="available"?e.jsxs(c,{size:"sm",onClick:()=>f(s),title:"Запросить доступ","data-testid":`button-request-${s.id}`,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Запросить"]}):s.accessStatus==="pending"?e.jsxs(c,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),i("common.pending")]}):s.accessStatus==="rejected"?e.jsx(c,{size:"sm",variant:"outline",onClick:()=>f(s),title:i("offers.retryRequest","Повторный запрос"),"data-testid":`button-retry-${s.id}`,children:i("offers.retry","Повторить")}):e.jsx(c,{size:"sm",onClick:()=>f(s),"data-testid":`button-request-${s.id}`,children:i("offers.requestAccess")}),e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",title:"Дополнительные действия","data-testid":`button-menu-${s.id}`,children:e.jsx(he,{className:"w-4 h-4"})})}),e.jsxs(ee,{align:"end",children:[e.jsxs(I,{onClick:()=>{window.location.href=`/affiliate/offers/${s.id}`},"data-testid":`menu-details-${s.id}`,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),i("offers.details","Детали")]}),e.jsxs(I,{onClick:()=>{window.location.href=`/affiliate/statistics?offer=${s.id}`},"data-testid":`menu-statistics-${s.id}`,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),i("offers.statistics","Статистика")]})]})]})]})})]},s.id)})})]})})})}),k.length===0&&e.jsx(x,{children:e.jsx(u,{className:"text-center py-8",children:e.jsx("div",{className:"text-muted-foreground",children:d||a!=="all-categories"||l!=="all"?"Офферы не найдены по заданным фильтрам":"Доступные офферы не найдены"})})}),p&&e.jsx(pe,{isOpen:y,onClose:()=>{o(!1),g(null)},offer:p})]})}export{ze as default};
