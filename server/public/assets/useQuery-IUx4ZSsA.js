var lt=e=>{throw TypeError(e)};var G=(e,t,i)=>t.has(e)||lt("Cannot "+i);var s=(e,t,i)=>(G(e,t,"read from private field"),i?i.call(e):t.get(e)),p=(e,t,i)=>t.has(e)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),h=(e,t,i,r)=>(G(e,t,"write to private field"),r?r.call(e,i):t.set(e,i),i),l=(e,t,i)=>(G(e,t,"access private method"),i);import{a2 as Ct,ai as dt,aj as y,a3 as J,ak as B,a7 as X,al as Y,am as ft,an as St,ao as Et,ap as Qt,aq as pt,a6 as gt,a8 as Tt,r as It}from"./index-Hu68kGEe.js";import{r as S}from"./vendor-DazevGLP.js";import"./ui-CkQMVfNu.js";var v,a,j,b,I,P,C,E,A,U,D,w,x,Q,M,n,L,Z,$,q,tt,et,st,it,yt,mt,wt=(mt=class extends Ct{constructor(t,i){super();p(this,n);p(this,v);p(this,a);p(this,j);p(this,b);p(this,I);p(this,P);p(this,C);p(this,E);p(this,A);p(this,U);p(this,D);p(this,w);p(this,x);p(this,Q);p(this,M,new Set);this.options=i,h(this,v,t),h(this,E,null),h(this,C,dt()),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,a).addObserver(this),bt(s(this,a),this.options)?l(this,n,L).call(this):this.updateResult(),l(this,n,tt).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return rt(s(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return rt(s(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,l(this,n,et).call(this),l(this,n,st).call(this),s(this,a).removeObserver(this)}setOptions(t){const i=this.options,r=s(this,a);if(this.options=s(this,v).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof y(this.options.enabled,s(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");l(this,n,it).call(this),s(this,a).setOptions(this.options),i._defaulted&&!J(this.options,i)&&s(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,a),observer:this});const u=this.hasListeners();u&&Rt(s(this,a),r,this.options,i)&&l(this,n,L).call(this),this.updateResult(),u&&(s(this,a)!==r||y(this.options.enabled,s(this,a))!==y(i.enabled,s(this,a))||B(this.options.staleTime,s(this,a))!==B(i.staleTime,s(this,a)))&&l(this,n,Z).call(this);const c=l(this,n,$).call(this);u&&(s(this,a)!==r||y(this.options.enabled,s(this,a))!==y(i.enabled,s(this,a))||c!==s(this,Q))&&l(this,n,q).call(this,c)}getOptimisticResult(t){const i=s(this,v).getQueryCache().build(s(this,v),t),r=this.createResult(i,t);return Ft(this,r)&&(h(this,b,r),h(this,P,this.options),h(this,I,s(this,a).state)),r}getCurrentResult(){return s(this,b)}trackResult(t,i){return new Proxy(t,{get:(r,u)=>(this.trackProp(u),i?.(u),u==="promise"&&!this.options.experimental_prefetchInRender&&s(this,C).status==="pending"&&s(this,C).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(r,u))})}trackProp(t){s(this,M).add(t)}getCurrentQuery(){return s(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=s(this,v).defaultQueryOptions(t),r=s(this,v).getQueryCache().build(s(this,v),i);return r.fetch().then(()=>this.createResult(r,i))}fetch(t){return l(this,n,L).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,b)))}createResult(t,i){const r=s(this,a),u=this.options,c=s(this,b),o=s(this,I),_=s(this,P),g=t!==r?t.state:s(this,j),{state:k}=t;let d={...k},H=!1,R;if(i._optimisticResults){const m=this.hasListeners(),z=!m&&bt(t,i),F=m&&Rt(t,r,i,u);(z||F)&&(d={...d,...Qt(k.data,t.options)}),i._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:nt,errorUpdatedAt:ot,status:T}=d;R=d.data;let ht=!1;if(i.placeholderData!==void 0&&R===void 0&&T==="pending"){let m;c?.isPlaceholderData&&i.placeholderData===_?.placeholderData?(m=c.data,ht=!0):m=typeof i.placeholderData=="function"?i.placeholderData(s(this,D)?.state.data,s(this,D)):i.placeholderData,m!==void 0&&(T="success",R=pt(c?.data,m,i),H=!0)}if(i.select&&R!==void 0&&!ht)if(c&&R===o?.data&&i.select===s(this,A))R=s(this,U);else try{h(this,A,i.select),R=i.select(R),R=pt(c?.data,R,i),h(this,U,R),h(this,E,null)}catch(m){h(this,E,m)}s(this,E)&&(nt=s(this,E),R=s(this,U),ot=Date.now(),T="error");const W=d.fetchStatus==="fetching",N=T==="pending",K=T==="error",ut=N&&W,ct=R!==void 0,O={status:T,fetchStatus:d.fetchStatus,isPending:N,isSuccess:T==="success",isError:K,isInitialLoading:ut,isLoading:ut,data:R,dataUpdatedAt:d.dataUpdatedAt,error:nt,errorUpdatedAt:ot,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>g.dataUpdateCount||d.errorUpdateCount>g.errorUpdateCount,isFetching:W,isRefetching:W&&!N,isLoadingError:K&&!ct,isPaused:d.fetchStatus==="paused",isPlaceholderData:H,isRefetchError:K&&ct,isStale:at(t,i),refetch:this.refetch,promise:s(this,C),isEnabled:y(i.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const m=V=>{O.status==="error"?V.reject(O.error):O.data!==void 0&&V.resolve(O.data)},z=()=>{const V=h(this,C,O.promise=dt());m(V)},F=s(this,C);switch(F.status){case"pending":t.queryHash===r.queryHash&&m(F);break;case"fulfilled":(O.status==="error"||O.data!==F.value)&&z();break;case"rejected":(O.status!=="error"||O.error!==F.reason)&&z();break}}return O}updateResult(){const t=s(this,b),i=this.createResult(s(this,a),this.options);if(h(this,I,s(this,a).state),h(this,P,this.options),s(this,I).data!==void 0&&h(this,D,s(this,a)),J(i,t))return;h(this,b,i);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:u}=this.options,c=typeof u=="function"?u():u;if(c==="all"||!c&&!s(this,M).size)return!0;const o=new Set(c??s(this,M));return this.options.throwOnError&&o.add("error"),Object.keys(s(this,b)).some(_=>{const f=_;return s(this,b)[f]!==t[f]&&o.has(f)})};l(this,n,yt).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&l(this,n,tt).call(this)}},v=new WeakMap,a=new WeakMap,j=new WeakMap,b=new WeakMap,I=new WeakMap,P=new WeakMap,C=new WeakMap,E=new WeakMap,A=new WeakMap,U=new WeakMap,D=new WeakMap,w=new WeakMap,x=new WeakMap,Q=new WeakMap,M=new WeakMap,n=new WeakSet,L=function(t){l(this,n,it).call(this);let i=s(this,a).fetch(this.options,t);return t?.throwOnError||(i=i.catch(X)),i},Z=function(){l(this,n,et).call(this);const t=B(this.options.staleTime,s(this,a));if(Y||s(this,b).isStale||!ft(t))return;const r=St(s(this,b).dataUpdatedAt,t)+1;h(this,w,setTimeout(()=>{s(this,b).isStale||this.updateResult()},r))},$=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,a)):this.options.refetchInterval)??!1},q=function(t){l(this,n,st).call(this),h(this,Q,t),!(Y||y(this.options.enabled,s(this,a))===!1||!ft(s(this,Q))||s(this,Q)===0)&&h(this,x,setInterval(()=>{(this.options.refetchIntervalInBackground||Et.isFocused())&&l(this,n,L).call(this)},s(this,Q)))},tt=function(){l(this,n,Z).call(this),l(this,n,q).call(this,l(this,n,$).call(this))},et=function(){s(this,w)&&(clearTimeout(s(this,w)),h(this,w,void 0))},st=function(){s(this,x)&&(clearInterval(s(this,x)),h(this,x,void 0))},it=function(){const t=s(this,v).getQueryCache().build(s(this,v),this.options);if(t===s(this,a))return;const i=s(this,a);h(this,a,t),h(this,j,t.state),this.hasListeners()&&(i?.removeObserver(this),t.addObserver(this))},yt=function(t){gt.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(s(this,b))}),s(this,v).getQueryCache().notify({query:s(this,a),type:"observerResultsUpdated"})})},mt);function xt(e,t){return y(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function bt(e,t){return xt(e,t)||e.state.data!==void 0&&rt(e,t,t.refetchOnMount)}function rt(e,t,i){if(y(t.enabled,e)!==!1&&B(t.staleTime,e)!=="static"){const r=typeof i=="function"?i(e):i;return r==="always"||r!==!1&&at(e,t)}return!1}function Rt(e,t,i,r){return(e!==t||y(r.enabled,e)===!1)&&(!i.suspense||e.state.status!=="error")&&at(e,i)}function at(e,t){return y(t.enabled,e)!==!1&&e.isStaleByTime(B(t.staleTime,e))}function Ft(e,t){return!J(e.getCurrentResult(),t)}var Ot=S.createContext(!1),Pt=()=>S.useContext(Ot);Ot.Provider;function Ut(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Dt=S.createContext(Ut()),Mt=()=>S.useContext(Dt),_t=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},kt=e=>{S.useEffect(()=>{e.clearReset()},[e])},Lt=({result:e,errorResetBoundary:t,throwOnError:i,query:r,suspense:u})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(u&&e.data===void 0||Tt(i,[e.error,r])),Bt=e=>{if(e.suspense){const t=r=>r==="static"?r:Math.max(r??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...r)=>t(i(...r)):t(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},jt=(e,t)=>e.isLoading&&e.isFetching&&!t,At=(e,t)=>e?.suspense&&t.isPending,vt=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function Ht(e,t,i){const r=Pt(),u=Mt(),c=It(),o=c.defaultQueryOptions(e);c.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=r?"isRestoring":"optimistic",Bt(o),_t(o,u),kt(u);const _=!c.getQueryCache().get(o.queryHash),[f]=S.useState(()=>new t(c,o)),g=f.getOptimisticResult(o),k=!r&&e.subscribed!==!1;if(S.useSyncExternalStore(S.useCallback(d=>{const H=k?f.subscribe(gt.batchCalls(d)):X;return f.updateResult(),H},[f,k]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),S.useEffect(()=>{f.setOptions(o)},[o,f]),At(o,g))throw vt(o,f,u);if(Lt({result:g,errorResetBoundary:u,throwOnError:o.throwOnError,query:c.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw g.error;return c.getDefaultOptions().queries?._experimental_afterQuery?.(o,g),o.experimental_prefetchInRender&&!Y&&jt(g,r)&&(_?vt(o,f,u):c.getQueryCache().get(o.queryHash)?.promise)?.catch(X).finally(()=>{f.updateResult()}),o.notifyOnChangeProps?g:f.trackResult(g)}function Gt(e,t){return Ht(e,wt)}export{Gt as u};
