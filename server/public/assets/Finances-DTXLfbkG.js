import{j as e}from"./ui-CkQMVfNu.js";import{r as g}from"./vendor-DazevGLP.js";import{u as E}from"./useQuery-qpsyHy1X.js";import{c as U,d as _,K as z,r as J,C as r,e as n,g as l,B as m,L as k,I as X,h as Y,i as G,j as Z,k as ee,l as f,f as h,R as se,Y as ae,y as te,o as re}from"./index-BiZ3ky40.js";import{u as ne}from"./useMutation-21NtthE3.js";import{B as u}from"./badge-B53pzHyE.js";import{T as le,a as ie,b as C,c as p,d as ce,e as i}from"./table-BX93bJ8w.js";import{D as de,e as oe,a as xe,b as me,c as he,d as ue,f as pe}from"./dialog-BZ5LljxY.js";import{T as je}from"./textarea-C_vyxygv.js";import{S as D}from"./skeleton-Dgipuram.js";import{a as c}from"./formatting-XXeiCqNP.js";import{a as ge}from"./queryClient-DKT_jxev.js";import{P as fe}from"./plus-DSksiBTA.js";import{D as M}from"./download-CVCRFTAG.js";import{D as O}from"./dollar-sign-B6jZtTHL.js";import{C as S}from"./clock-BdukKcj2.js";import"./utils-B-_CankM.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=U("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=U("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);function qe(){const[q,b]=g.useState(!1),[j,T]=g.useState(""),[w,L]=g.useState(""),[N,R]=g.useState(""),{toast:a}=_(),{t:d}=z(),F=J(),{data:t,isLoading:B}=E({queryKey:["/api/partner/finance/summary"]}),{data:v,isLoading:I}=E({queryKey:["/api/partner/finance/transactions"]}),W=B||I,y=ne({mutationFn:async s=>ge("/api/partner/finance/withdrawal","POST",s),onSuccess:()=>{a({title:d("finances.messages.withdrawalRequested"),description:d("finances.messages.withdrawalRequestedDesc"),variant:"default"}),b(!1),T(""),L(""),R(""),F.invalidateQueries({queryKey:["/api/partner/finance/summary"]}),F.invalidateQueries({queryKey:["/api/partner/finance/transactions"]})},onError:()=>{a({title:d("common.error"),description:d("finances.messages.withdrawalError"),variant:"destructive"})}}),H=()=>{if(!j||!w||!N){a({title:"Заполните все поля",description:"Все поля обязательны для заполнения",variant:"destructive"});return}if(parseFloat(j)>t?.balance){a({title:"Недостаточно средств",description:"Сумма вывода превышает доступный баланс",variant:"destructive"});return}y.mutate({amount:parseFloat(j),method:w,details:N})},K=s=>{switch(s){case"completed":return e.jsxs(u,{variant:"default",className:"bg-green-100 text-green-700",children:[e.jsx(re,{className:"w-3 h-3 mr-1"}),"Завершено"]});case"pending":return e.jsxs(u,{variant:"secondary",className:"bg-yellow-100 text-yellow-700",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Ожидание"]});case"processing":return e.jsxs(u,{variant:"outline",className:"bg-blue-100 text-blue-700",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Обработка"]});case"failed":return e.jsxs(u,{variant:"destructive",className:"bg-red-100 text-red-700",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"Отклонено"]});default:return e.jsx(u,{variant:"secondary",children:s})}},V=s=>{switch(s){case"commission":case"bonus":return e.jsx(we,{className:"h-4 w-4 text-green-600"});case"payout":return e.jsx(be,{className:"h-4 w-4 text-red-600"});default:return e.jsx(O,{className:"h-4 w-4 text-gray-600"})}},$=s=>{switch(s){case"commission":return"Комиссия";case"bonus":return"Бонус";case"payout":return"Вывод";default:return s}},P=async s=>{try{const o=await fetch("/api/partner/finance/export?format="+s,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Failed to export");const Q=await o.blob(),A=window.URL.createObjectURL(Q),x=document.createElement("a");x.href=A,x.download=`finance-report-${new Date().toISOString().split("T")[0]}.${s}`,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(A),document.body.removeChild(x),a({title:"Отчёт загружен",description:`Финансовый отчёт в формате ${s.toUpperCase()} успешно загружен`,variant:"default"})}catch{a({title:"Ошибка",description:"Не удалось загрузить отчёт",variant:"destructive"})}};return W?e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx(D,{className:"h-8 w-48"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:Array.from({length:4}).map((s,o)=>e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(D,{className:"h-4 w-20"})}),e.jsx(l,{children:e.jsx(D,{className:"h-8 w-16"})})]},o))})]}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:d("finances.title")}),e.jsx("p",{className:"text-muted-foreground",children:"Управление балансом и выводом средств"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(de,{open:q,onOpenChange:b,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Вывод средств"]})}),e.jsxs(xe,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Вывод средств"}),e.jsxs(ue,{children:["Создание заявки на вывод средств. Доступно: ",c(t?.balance||0)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"amount",children:"Сумма"}),e.jsx(X,{id:"amount",type:"number",step:"0.01",placeholder:"0.00",value:j,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"method",children:"Способ получения"}),e.jsxs(Y,{value:w,onValueChange:L,children:[e.jsx(G,{children:e.jsx(Z,{placeholder:"Выберите способ"})}),e.jsxs(ee,{children:[e.jsx(f,{value:"paypal",children:"PayPal"}),e.jsx(f,{value:"bank_card",children:"Банковская карта"}),e.jsx(f,{value:"bank_transfer",children:"Банковский перевод"}),e.jsx(f,{value:"crypto",children:"Криптовалюта"})]})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"details",children:"Реквизиты"}),e.jsx(je,{id:"details",placeholder:"Укажите реквизиты для получения средств",value:N,onChange:s=>R(s.target.value)})]})]}),e.jsxs(pe,{children:[e.jsx(m,{variant:"outline",onClick:()=>b(!1),children:"Отмена"}),e.jsx(m,{onClick:H,disabled:y.isPending,children:y.isPending?"Отправка...":"Отправить заявку"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:()=>P("csv"),title:"Скачать отчёт в CSV",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"CSV"]}),e.jsxs(m,{variant:"outline",onClick:()=>P("json"),title:"Скачать отчёт в JSON",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"JSON"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(r,{className:"border-l-4 border-l-green-500 bg-gradient-to-br from-green-50 to-white dark:from-green-900/20 dark:to-background",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Текущий баланс"}),e.jsx(O,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:c(t?.balance||0)}),e.jsx("p",{className:"text-xs text-green-600/80 dark:text-green-400/80",children:"Доступно к выводу"})]})]}),e.jsxs(r,{className:"border-l-4 border-l-orange-500 bg-gradient-to-br from-orange-50 to-white dark:from-orange-900/20 dark:to-background",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"В ожидании"}),e.jsx(S,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700 dark:text-orange-300",children:c(t?.pendingPayouts||0)}),e.jsx("p",{className:"text-xs text-orange-600/80 dark:text-orange-400/80",children:"Ожидает подтверждения"})]})]}),e.jsxs(r,{className:"border-l-4 border-l-blue-500 bg-gradient-to-br from-blue-50 to-white dark:from-blue-900/20 dark:to-background",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Общий доход"}),e.jsx(se,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:c(t?.totalRevenue||0)}),e.jsx("p",{className:"text-xs text-blue-600/80 dark:text-blue-400/80",children:"За всё время"})]})]}),e.jsxs(r,{className:"border-l-4 border-l-purple-500 bg-gradient-to-br from-purple-50 to-white dark:from-purple-900/20 dark:to-background",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:"Средний EPC"}),e.jsx(ae,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-300",children:c(t?.avgEPC||0)}),e.jsx("p",{className:"text-xs text-purple-600/80 dark:text-purple-400/80",children:"Доходность на клик"})]})]})]}),e.jsxs(r,{children:[e.jsx(n,{children:e.jsx(h,{children:"История операций"})}),e.jsx(l,{children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(C,{children:[e.jsx(p,{children:"Дата"}),e.jsx(p,{children:"Описание"}),e.jsx(p,{children:"Сумма"}),e.jsx(p,{children:"Статус"}),e.jsx(p,{children:"Детали"})]})}),e.jsxs(ce,{children:[(v||[]).map(s=>e.jsxs(C,{children:[e.jsx(i,{className:"font-medium",children:new Date(s.createdAt).toLocaleDateString("ru-RU")}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[V(s.type),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.comment||"Транзакция"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:$(s.type)})]})]})}),e.jsx(i,{children:e.jsxs("span",{className:`font-medium ${(s.amount||0)>=0?"text-green-600":"text-red-600"}`,children:[(s.amount||0)>=0?"+":"",c(Math.abs(s.amount||0))]})}),e.jsx(i,{children:K(s.status)}),e.jsxs(i,{className:"text-sm text-muted-foreground",children:["ID: ",s.id.substring(0,8),"..."]})]},s.id)),(!v||v.length===0)&&e.jsx(C,{children:e.jsx(i,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"Транзакции не найдены"})})]})]})})]})]})}export{qe as default};
