import{a1 as u}from"./index-Hu68kGEe.js";async function c(t){if(!t.ok){const e=await t.text()||t.statusText;throw new Error(`${t.status}: ${e}`)}}async function y(t,e="GET",n,r){const a=typeof e=="string"?e:"GET";if(console.log("🔧 apiRequest call:",{url:t,originalMethod:e,methodType:typeof e,finalMethod:a,methodValue:JSON.stringify(e)}),typeof e!="string")throw console.error("❌ INVALID METHOD IN apiRequest:",{method:e,methodType:typeof e,stack:new Error().stack}),new Error(`Invalid method in apiRequest: ${typeof e}. Expected string, got ${typeof e}`);localStorage.getItem("token")&&localStorage.removeItem("token");let o=localStorage.getItem("auth_token");(o==="null"||o==="undefined"||!o||o.trim()==="")&&(console.log("🚨 Invalid token detected, clearing:",o),localStorage.removeItem("auth_token"),o=null),console.log("🔐 apiRequest token check:",{url:t,method:a,hasToken:!!o,tokenStart:o?o.substring(0,20)+"...":"NO_TOKEN"});const i={"Content-Type":"application/json",...r};o&&(i.Authorization=`Bearer ${o}`);const s=await fetch(t,{method:a,headers:i,body:n?JSON.stringify(n):void 0,credentials:"include"});await c(s);const l=await s.text();return l?JSON.parse(l):null}const f=({on401:t})=>async({queryKey:e})=>{localStorage.getItem("token")&&localStorage.removeItem("token");const n=localStorage.getItem("auth_token"),r={};n&&n!=="null"&&n!=="undefined"&&n.trim()!==""&&(r.Authorization=`Bearer ${n}`);const a=await fetch(e[0],{method:"GET",headers:r,credentials:"include"});return await c(a),await a.json()},g=new u({defaultOptions:{queries:{queryFn:f({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:30*1e3,gcTime:5*60*1e3,retry:(t,e)=>e?.message?.includes("4")?!1:t<2,retryDelay:t=>Math.min(1e3*2**t,3e4)},mutations:{retry:(t,e)=>e?.message?.includes("4")?!1:t<1}}});window.queryClient=g;export{y as a};
