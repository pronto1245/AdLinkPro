# 🔧 ДЕТАЛЬНЫЕ КОНФИГУРАЦИИ AdLinkPro
## Полные конфигурационные файлы для развертывания

---

## 📦 **PACKAGE.JSON - ЗАВИСИМОСТИ И СКРИПТЫ**

```json
{
  "name": "adlinkpro-affiliate-platform",
  "version": "2.0.0",
  "type": "module",
  "license": "MIT",
  "description": "Professional anti-fraud affiliate marketing platform",
  "keywords": ["affiliate", "marketing", "antifraud", "tracking", "analytics"],
  "homepage": "https://github.com/pronto1245/AdLinkPro",
  "repository": {
    "type": "git",
    "url": "https://github.com/pronto1245/AdLinkPro.git"
  },
  "bugs": {
    "url": "https://github.com/pronto1245/AdLinkPro/issues"
  },
  "scripts": {
    "dev": "NODE_ENV=development tsx server/index.ts",
    "build": "npm run build:client && npm run build:server",
    "build:client": "vite build",
    "build:server": "esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist",
    "start": "NODE_ENV=production node dist/index.js",
    "start:dev": "NODE_ENV=development tsx server/index.ts",
    "start:prod": "NODE_ENV=production node dist/index.js",
    "check": "tsc --noEmit",
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "format": "prettier --write .",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "db:push": "drizzle-kit push",
    "db:pull": "drizzle-kit pull",
    "db:generate": "drizzle-kit generate",
    "db:migrate": "drizzle-kit migrate",
    "db:studio": "drizzle-kit studio",
    "db:seed": "tsx server/scripts/seed-database.ts",
    "db:backup": "tsx server/scripts/backup-database.ts",
    "db:restore": "tsx server/scripts/restore-database.ts",
    "deploy": "npm run build && npm run start:prod",
    "deploy:docker": "docker-compose -f docker-compose.prod.yml up --build -d",
    "deploy:stop": "docker-compose -f docker-compose.prod.yml down",
    "health": "curl -f http://localhost:5000/api/health",
    "logs": "pm2 logs adlinkpro",
    "monitor": "pm2 monit",
    "restart": "pm2 restart adlinkpro",
    "stop": "pm2 stop adlinkpro",
    "reload": "pm2 reload adlinkpro",
    "cleanup": "tsx server/scripts/cleanup.ts",
    "backup": "tsx server/scripts/backup.ts",
    "analyze": "npm run build && npx source-map-explorer dist/assets/*.js",
    "security-check": "npm audit && snyk test",
    "update-deps": "npx npm-check-updates -u"
  },
  "dependencies": {
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/sortable": "^10.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@google-cloud/storage": "^7.16.0",
    "@hookform/resolvers": "^3.10.0",
    "@neondatabase/serverless": "^0.10.4",
    "@radix-ui/react-accordion": "^1.2.4",
    "@radix-ui/react-alert-dialog": "^1.1.7",
    "@radix-ui/react-aspect-ratio": "^1.1.3",
    "@radix-ui/react-avatar": "^1.1.4",
    "@radix-ui/react-checkbox": "^1.1.5",
    "@radix-ui/react-collapsible": "^1.1.4",
    "@radix-ui/react-context-menu": "^2.2.7",
    "@radix-ui/react-dialog": "^1.1.7",
    "@radix-ui/react-dropdown-menu": "^2.1.7",
    "@radix-ui/react-hover-card": "^1.1.7",
    "@radix-ui/react-label": "^2.1.3",
    "@radix-ui/react-menubar": "^1.1.7",
    "@radix-ui/react-navigation-menu": "^1.2.6",
    "@radix-ui/react-popover": "^1.1.7",
    "@radix-ui/react-progress": "^1.1.3",
    "@radix-ui/react-radio-group": "^1.2.4",
    "@radix-ui/react-scroll-area": "^1.2.4",
    "@radix-ui/react-select": "^2.1.7",
    "@radix-ui/react-separator": "^1.1.3",
    "@radix-ui/react-slider": "^1.2.4",
    "@radix-ui/react-slot": "^1.2.0",
    "@radix-ui/react-switch": "^1.1.4",
    "@radix-ui/react-tabs": "^1.1.4",
    "@radix-ui/react-toast": "^1.2.7",
    "@radix-ui/react-toggle": "^1.1.3",
    "@radix-ui/react-toggle-group": "^1.1.3",
    "@radix-ui/react-tooltip": "^1.2.0",
    "@sendgrid/mail": "^8.1.5",
    "@tanstack/react-query": "^5.60.5",
    "@uppy/aws-s3": "^4.3.2",
    "@uppy/core": "^4.5.2",
    "@uppy/dashboard": "^4.4.3",
    "@uppy/drag-drop": "^4.2.2",
    "@uppy/file-input": "^4.2.2",
    "@uppy/progress-bar": "^4.3.2",
    "@uppy/react": "^4.5.2",
    "acme-client": "^5.4.0",
    "archiver": "^7.0.1",
    "bcrypt": "^6.0.0",
    "bullmq": "^5.56.9",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "compression": "^1.8.1",
    "connect-pg-simple": "^10.0.0",
    "date-fns": "^3.6.0",
    "drizzle-orm": "^0.39.1",
    "drizzle-zod": "^0.7.0",
    "embla-carousel-react": "^8.6.0",
    "express": "^4.21.2",
    "express-rate-limit": "^7.4.1",
    "express-session": "^1.18.1",
    "framer-motion": "^11.15.0",
    "google-auth-library": "^9.16.0",
    "helmet": "^8.0.0",
    "i18next": "^24.0.5",
    "i18next-browser-languagedetector": "^8.0.2",
    "input-otp": "^1.4.1",
    "ioredis": "^5.4.2",
    "jsonwebtoken": "^9.0.2",
    "jszip": "^3.10.1",
    "lucide-react": "^0.468.0",
    "memoizee": "^0.4.17",
    "memorystore": "^1.7.0",
    "nanoid": "^5.0.9",
    "next-themes": "^0.4.4",
    "node-fetch": "^3.3.2",
    "openid-client": "^6.1.5",
    "passport": "^0.7.0",
    "passport-local": "^1.0.0",
    "react": "^18.3.1",
    "react-day-picker": "^9.4.4",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.54.0",
    "react-i18next": "^15.2.0",
    "react-icons": "^5.4.0",
    "react-resizable-panels": "^2.1.7",
    "recharts": "^2.13.3",
    "tailwind-merge": "^2.5.4",
    "tailwindcss": "^3.4.17",
    "tailwindcss-animate": "^1.0.7",
    "tsx": "^4.19.2",
    "tw-animate-css": "^0.2.1",
    "typescript": "^5.7.2",
    "vaul": "^1.1.1",
    "wouter": "^3.3.5",
    "ws": "^8.18.0",
    "zod": "^3.24.1",
    "zod-validation-error": "^3.4.0"
  },
  "devDependencies": {
    "@replit/vite-plugin-cartographer": "^1.0.3",
    "@replit/vite-plugin-runtime-error-modal": "^1.0.2",
    "@tailwindcss/typography": "^0.5.15",
    "@tailwindcss/vite": "^4.0.0-alpha.40",
    "@types/archiver": "^6.0.3",
    "@types/bcrypt": "^6.0.0",
    "@types/compression": "^1.8.1",
    "@types/connect-pg-simple": "^7.0.3",
    "@types/express": "^5.0.0",
    "@types/express-session": "^1.18.0",
    "@types/jsonwebtoken": "^9.0.10",
    "@types/memoizee": "^0.4.12",
    "@types/node": "^22.10.2",
    "@types/passport": "^1.0.16",
    "@types/passport-local": "^1.0.38",
    "@types/react": "^18.3.17",
    "@types/react-dom": "^18.3.5",
    "@types/ws": "^8.5.13",
    "@typescript-eslint/eslint-plugin": "^8.18.1",
    "@typescript-eslint/parser": "^8.18.1",
    "@vitejs/plugin-react": "^4.3.4",
    "@vitest/coverage-v8": "^2.1.8",
    "@vitest/ui": "^2.1.8",
    "autoprefixer": "^10.4.20",
    "drizzle-kit": "^0.31.2",
    "esbuild": "^0.24.2",
    "eslint": "^9.17.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-plugin-react": "^7.37.2",
    "eslint-plugin-react-hooks": "^5.0.0",
    "postcss": "^8.5.7",
    "prettier": "^3.4.2",
    "prettier-plugin-tailwindcss": "^0.6.9",
    "snyk": "^1.1294.0",
    "source-map-explorer": "^2.5.3",
    "vite": "^6.0.3",
    "vitest": "^2.1.8"
  },
  "engines": {
    "node": ">=20.0.0",
    "npm": ">=10.0.0"
  },
  "browserslist": [
    "> 1%",
    "last 2 versions",
    "not dead"
  ],
  "volta": {
    "node": "20.18.0",
    "npm": "10.8.2"
  }
}
```

---

## ⚙️ **TSCONFIG.JSON - TYPESCRIPT КОНФИГУРАЦИЯ**

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleDetection": "force",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./client/src/*"],
      "@shared/*": ["./shared/*"],
      "@assets/*": ["./attached_assets/*"],
      "@server/*": ["./server/*"]
    },
    "types": ["node", "vite/client"],
    "esModuleInterop": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "removeComments": false,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "strictPropertyInitialization": false,
    "allowJs": true,
    "checkJs": false,
    "incremental": true,
    "tsBuildInfoFile": "./.cache/typescript/tsbuildinfo"
  },
  "include": [
    "client/src/**/*",
    "server/**/*",
    "shared/**/*",
    "scripts/**/*",
    "*.ts",
    "*.tsx"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "coverage",
    ".cache",
    "**/*.test.ts",
    "**/*.test.tsx",
    "**/*.spec.ts",
    "**/*.spec.tsx"
  ],
  "ts-node": {
    "esm": true,
    "experimentalSpecifierResolution": "node"
  }
}
```

---

## 🎨 **VITE.CONFIG.TS - СБОРЩИК КОНФИГУРАЦИЯ**

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";
import runtimeErrorOverlay from "@replit/vite-plugin-runtime-error-modal";

export default defineConfig({
  plugins: [
    react({
      jsxImportSource: "react",
      babel: {
        plugins: [
          ["@babel/plugin-proposal-decorators", { legacy: true }],
          ["@babel/plugin-proposal-class-properties", { loose: true }]
        ]
      }
    }),
    runtimeErrorOverlay(),
    ...(process.env.NODE_ENV !== "production" &&
    process.env.REPL_ID !== undefined
      ? [
          await import("@replit/vite-plugin-cartographer").then((m) =>
            m.cartographer(),
          ),
        ]
      : []),
  ],
  resolve: {
    alias: {
      "@": path.resolve(import.meta.dirname, "client", "src"),
      "@shared": path.resolve(import.meta.dirname, "shared"),
      "@assets": path.resolve(import.meta.dirname, "attached_assets"),
      "@server": path.resolve(import.meta.dirname, "server"),
    },
  },
  root: path.resolve(import.meta.dirname, "client"),
  publicDir: path.resolve(import.meta.dirname, "public"),
  build: {
    outDir: path.resolve(import.meta.dirname, "dist/public"),
    emptyOutDir: true,
    sourcemap: process.env.NODE_ENV === "development",
    minify: process.env.NODE_ENV === "production" ? "esbuild" : false,
    target: "es2022",
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ["react", "react-dom"],
          ui: ["@radix-ui/react-accordion", "@radix-ui/react-dialog"],
          charts: ["recharts"],
          utils: ["date-fns", "clsx", "tailwind-merge"]
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  server: {
    host: "0.0.0.0",
    port: 3000,
    strictPort: true,
    fs: {
      strict: true,
      deny: ["**/.*", "**/node_modules/**"]
    },
    proxy: {
      "/api": {
        target: "http://localhost:5000",
        changeOrigin: true,
        secure: false
      },
      "/ws": {
        target: "ws://localhost:5000",
        ws: true,
        changeOrigin: true
      }
    }
  },
  preview: {
    host: "0.0.0.0",
    port: 3000,
    strictPort: true
  },
  optimizeDeps: {
    include: [
      "react",
      "react-dom",
      "@tanstack/react-query",
      "wouter",
      "i18next",
      "react-i18next",
      "date-fns",
      "recharts"
    ],
    exclude: ["@replit/vite-plugin-cartographer"]
  },
  define: {
    __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
    __BUILD_TIME__: JSON.stringify(new Date().toISOString())
  },
  css: {
    postcss: {
      plugins: [
        require("tailwindcss"),
        require("autoprefixer")
      ]
    },
    devSourcemap: true
  },
  esbuild: {
    target: "es2022",
    format: "esm",
    platform: "browser"
  }
});
```

---

## 🗄️ **DRIZZLE.CONFIG.TS - БАЗА ДАННЫХ ORM**

```typescript
import { defineConfig } from "drizzle-kit";
import "dotenv/config";

if (!process.env.DATABASE_URL) {
  throw new Error(
    "DATABASE_URL environment variable is required. Please ensure the database is provisioned and the URL is set."
  );
}

export default defineConfig({
  out: "./migrations",
  schema: "./shared/schema.ts",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL,
  },
  verbose: true,
  strict: true,
  tablesFilter: ["!drizzle__*"],
  schemaFilter: ["public"],
  migrations: {
    prefix: "timestamp",
    table: "__drizzle_migrations__",
    schema: "public"
  },
  introspect: {
    casing: "camel"
  },
  breakpoints: true,
  driver: "pg"
});
```

---

## 🎨 **TAILWIND.CONFIG.TS - CSS ФРЕЙМВОРК**

```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: ["class"],
  content: [
    "./client/src/**/*.{js,ts,jsx,tsx}",
    "./client/index.html",
    "./shared/**/*.{js,ts,jsx,tsx}"
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        chart: {
          "1": "hsl(var(--chart-1))",
          "2": "hsl(var(--chart-2))",
          "3": "hsl(var(--chart-3))",
          "4": "hsl(var(--chart-4))",
          "5": "hsl(var(--chart-5))",
        },
        sidebar: {
          DEFAULT: "hsl(var(--sidebar-background))",
          foreground: "hsl(var(--sidebar-foreground))",
          primary: "hsl(var(--sidebar-primary))",
          "primary-foreground": "hsl(var(--sidebar-primary-foreground))",
          accent: "hsl(var(--sidebar-accent))",
          "accent-foreground": "hsl(var(--sidebar-accent-foreground))",
          border: "hsl(var(--sidebar-border))",
          ring: "hsl(var(--sidebar-ring))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      fontFamily: {
        sans: ["Inter", "ui-sans-serif", "system-ui"],
        mono: ["JetBrains Mono", "ui-monospace", "monospace"],
      },
      fontSize: {
        xs: ["0.75rem", { lineHeight: "1rem" }],
        sm: ["0.875rem", { lineHeight: "1.25rem" }],
        base: ["1rem", { lineHeight: "1.5rem" }],
        lg: ["1.125rem", { lineHeight: "1.75rem" }],
        xl: ["1.25rem", { lineHeight: "1.75rem" }],
      },
      spacing: {
        "18": "4.5rem",
        "88": "22rem",
        "128": "32rem",
      },
      animation: {
        "fade-in": "fadeIn 0.5s ease-in-out",
        "slide-in": "slideIn 0.3s ease-out",
        "bounce-in": "bounceIn 0.6s ease-out",
        "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
      },
      keyframes: {
        fadeIn: {
          "0%": { opacity: "0" },
          "100%": { opacity: "1" },
        },
        slideIn: {
          "0%": { transform: "translateY(-10px)", opacity: "0" },
          "100%": { transform: "translateY(0)", opacity: "1" },
        },
        bounceIn: {
          "0%, 20%, 40%, 60%, 80%": {
            animationTimingFunction: "cubic-bezier(0.215, 0.61, 0.355, 1)",
          },
          "0%": {
            opacity: "0",
            transform: "scale3d(0.3, 0.3, 0.3)",
          },
          "20%": {
            transform: "scale3d(1.1, 1.1, 1.1)",
          },
          "40%": {
            transform: "scale3d(0.9, 0.9, 0.9)",
          },
          "60%": {
            opacity: "1",
            transform: "scale3d(1.03, 1.03, 1.03)",
          },
          "80%": {
            transform: "scale3d(0.97, 0.97, 0.97)",
          },
          "100%": {
            opacity: "1",
            transform: "scale3d(1, 1, 1)",
          },
        },
      },
      backgroundImage: {
        "gradient-radial": "radial-gradient(var(--tw-gradient-stops))",
        "gradient-conic": "conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))",
      },
      boxShadow: {
        "elevation-1": "0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)",
        "elevation-2": "0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",
        "elevation-3": "0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23)",
      },
    },
  },
  plugins: [
    require("tailwindcss-animate"),
    require("@tailwindcss/typography"),
    require("@tailwindcss/forms"),
    require("@tailwindcss/aspect-ratio"),
  ],
};

export default config;
```

---

## 🔒 **ENV.EXAMPLE - ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ**

```bash
# =================================================================
# AdLinkPro Environment Configuration
# =================================================================

# ====================
# ОСНОВНЫЕ НАСТРОЙКИ
# ====================
NODE_ENV=production
PORT=5000
DOMAIN=your-domain.com

# ====================
# БАЗА ДАННЫХ
# ====================
# PostgreSQL Database URL (Required)
# Пример: postgresql://username:password@host:port/database
DATABASE_URL=postgresql://adlinkpro:password@localhost:5432/adlinkpro

# ====================
# БЕЗОПАСНОСТЬ
# ====================
# JWT Secret (Минимум 64 символа, сгенерируйте случайную строку)
JWT_SECRET=your-super-secret-jwt-key-minimum-64-characters-long-here

# Session Secret (Минимум 32 символа)
SESSION_SECRET=your-session-secret-key-minimum-32-characters

# CORS разрешенные домены (через запятую)
CORS_ORIGINS=https://your-domain.com,https://www.your-domain.com

# Rate limiting (запросов в минуту)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# ====================
# REDIS (Кеширование и сессии)
# ====================
REDIS_URL=redis://localhost:6379
REDIS_PREFIX=adlinkpro:
REDIS_TTL=3600

# ====================
# EMAIL СЕРВИС
# ====================
# SendGrid API Key (для email уведомлений)
SENDGRID_API_KEY=your-sendgrid-api-key
SENDGRID_FROM_EMAIL=noreply@your-domain.com
SENDGRID_FROM_NAME=AdLinkPro

# SMTP настройки (альтернатива SendGrid)
SMTP_HOST=smtp.your-provider.com
SMTP_PORT=587
SMTP_USER=your-smtp-username
SMTP_PASS=your-smtp-password
SMTP_SECURE=true

# ====================
# ВНЕШНИЕ ТРЕКЕРЫ
# ====================
# Voluum Tracker API
VOLUUM_TOKEN=your-voluum-api-token
VOLUUM_API_URL=https://api.voluum.com

# Keitaro Tracker API
KEITARO_TOKEN=your-keitaro-api-token
KEITARO_API_URL=https://your-keitaro-domain.com/api

# Binom Tracker API
BINOM_TOKEN=your-binom-api-token
BINOM_API_URL=https://your-binom-domain.com/api

# RedTrack API
REDTRACK_TOKEN=your-redtrack-api-token
REDTRACK_API_URL=https://api.redtrack.io

# ====================
# GOOGLE CLOUD STORAGE
# ====================
GOOGLE_CLOUD_PROJECT_ID=your-gcp-project-id
GOOGLE_CLOUD_STORAGE_BUCKET=your-storage-bucket-name
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# ====================
# TELEGRAM BOT
# ====================
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
TELEGRAM_WEBHOOK_URL=https://your-domain.com/api/telegram/webhook
TELEGRAM_ADMIN_CHAT_ID=your-admin-chat-id

# ====================
# ПЛАТЕЖНЫЕ СИСТЕМЫ
# ====================
# Stripe
STRIPE_SECRET_KEY=sk_live_your-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=pk_live_your-stripe-publishable-key
STRIPE_WEBHOOK_SECRET=whsec_your-stripe-webhook-secret

# PayPal
PAYPAL_CLIENT_ID=your-paypal-client-id
PAYPAL_CLIENT_SECRET=your-paypal-client-secret
PAYPAL_MODE=live

# Crypto API
BLOCKCHAIN_API_KEY=your-blockchain-api-key
COINBASE_API_KEY=your-coinbase-api-key
COINBASE_API_SECRET=your-coinbase-api-secret

# ====================
# МОНИТОРИНГ И ЛОГИРОВАНИЕ
# ====================
# Prometheus metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_ENABLED=true
GRAFANA_ADMIN_PASSWORD=your-grafana-password

# Winston logging level
LOG_LEVEL=info
LOG_FILE_PATH=/var/log/adlinkpro/app.log
LOG_MAX_FILES=10
LOG_MAX_SIZE=100m

# Sentry error tracking
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# ====================
# АНТИФРОД НАСТРОЙКИ
# ====================
# IP Geolocation
IP_GEOLOCATION_API_KEY=your-ip-geolocation-api-key

# Fraud detection thresholds
FRAUD_DETECTION_ENABLED=true
FRAUD_RISK_THRESHOLD=70
FRAUD_AUTO_BLOCK_THRESHOLD=90

# VPN/Proxy detection
VPN_DETECTION_ENABLED=true
VPN_DETECTION_API_KEY=your-vpn-detection-api-key

# ====================
# CDN И КЕШИРОВАНИЕ
# ====================
# CloudFlare
CLOUDFLARE_API_TOKEN=your-cloudflare-api-token
CLOUDFLARE_ZONE_ID=your-cloudflare-zone-id

# AWS CloudFront
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1
CLOUDFRONT_DISTRIBUTION_ID=your-cloudfront-distribution-id

# ====================
# АНАЛИТИКА
# ====================
# Google Analytics
GOOGLE_ANALYTICS_ID=GA-XXXXXXXXX

# Facebook Pixel
FACEBOOK_PIXEL_ID=your-facebook-pixel-id

# Google Tag Manager
GTM_CONTAINER_ID=GTM-XXXXXXX

# ====================
# SSL И ДОМЕНЫ
# ====================
# Let's Encrypt
LETSENCRYPT_EMAIL=admin@your-domain.com
LETSENCRYPT_STAGING=false

# Custom SSL
SSL_CERT_PATH=/etc/ssl/certs/your-domain.crt
SSL_KEY_PATH=/etc/ssl/private/your-domain.key

# ====================
# РЕЗЕРВНОЕ КОПИРОВАНИЕ
# ====================
# Backup settings
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=your-backup-bucket
BACKUP_ENCRYPTION_KEY=your-backup-encryption-key

# ====================
# РАЗРАБОТКА (только для DEV)
# ====================
# Debug settings (только для NODE_ENV=development)
DEBUG_ENABLED=false
DEBUG_SQL_QUERIES=false
DEBUG_API_REQUESTS=false

# Hot reload
HOT_RELOAD=true

# Test database
TEST_DATABASE_URL=postgresql://test:test@localhost:5432/adlinkpro_test

# ====================
# ПРОИЗВОДИТЕЛЬНОСТЬ
# ====================
# Cluster settings
CLUSTER_WORKERS=auto
PM2_INSTANCES=max

# Memory limits
NODE_OPTIONS=--max-old-space-size=4096
MAX_REQUEST_SIZE=50mb
MAX_FILE_SIZE=100mb

# Connection pooling
DB_POOL_MIN=2
DB_POOL_MAX=20
DB_POOL_IDLE_TIMEOUT=30000

# ====================
# ИНТЕГРАЦИИ API
# ====================
# Exchange rates
EXCHANGE_RATES_API_KEY=your-exchange-rates-api-key

# SMS providers
TWILIO_ACCOUNT_SID=your-twilio-account-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=+1234567890

# Push notifications
FIREBASE_SERVER_KEY=your-firebase-server-key
FIREBASE_PROJECT_ID=your-firebase-project-id

# Social OAuth
GOOGLE_OAUTH_CLIENT_ID=your-google-oauth-client-id
GOOGLE_OAUTH_CLIENT_SECRET=your-google-oauth-client-secret

FACEBOOK_APP_ID=your-facebook-app-id
FACEBOOK_APP_SECRET=your-facebook-app-secret

# ====================
# WEBHOOK URLS
# ====================
POSTBACK_CALLBACK_URL=https://your-domain.com/api/postback/receive
PAYMENT_WEBHOOK_URL=https://your-domain.com/api/webhooks/payment
FRAUD_WEBHOOK_URL=https://your-domain.com/api/webhooks/fraud

# ====================
# ПРИМЕЧАНИЯ
# ====================
# 1. Все секретные ключи должны быть сгенерированы случайным образом
# 2. В production НИКОГДА не используйте значения по умолчанию
# 3. Регулярно ротируйте API ключи и секреты
# 4. Используйте SSL для всех внешних подключений
# 5. Настройте мониторинг для всех критичных сервисов
```

---

## 🔧 **PM2.CONFIG.JS - ПРОЦЕСС МЕНЕДЖЕР**

```javascript
module.exports = {
  apps: [{
    name: 'adlinkpro',
    script: 'dist/index.js',
    instances: process.env.PM2_INSTANCES || 'max',
    exec_mode: 'cluster',
    
    // Environment variables
    env: {
      NODE_ENV: 'development',
      PORT: 5000
    },
    env_production: {
      NODE_ENV: 'production',
      PORT: 5000
    },
    
    // Logging
    log_file: '/var/log/adlinkpro/combined.log',
    out_file: '/var/log/adlinkpro/out.log',
    error_file: '/var/log/adlinkpro/error.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    
    // Process management
    autorestart: true,
    max_restarts: 10,
    min_uptime: '10s',
    restart_delay: 4000,
    
    // Memory management
    max_memory_restart: '1G',
    
    // Performance monitoring
    monitoring: true,
    pmx: true,
    
    // Health check
    health_check_grace_period: 3000,
    
    // Advanced options
    node_args: '--max-old-space-size=4096',
    
    // Watch and ignore patterns
    watch: false,
    ignore_watch: [
      'node_modules',
      'logs',
      'dist',
      '.git',
      '*.log'
    ],
    
    // Graceful shutdown
    kill_timeout: 5000,
    listen_timeout: 3000,
    
    // Source map support
    source_map_support: true,
    
    // Custom restart triggers
    restart_delay: 4000,
    exponential_backoff_restart_delay: 100,
    
    // Environment specific overrides
    env_staging: {
      NODE_ENV: 'staging',
      instances: 2
    },
    
    // Error handling
    error_file: '/var/log/adlinkpro/error.log',
    combine_logs: true,
    
    // Additional metadata
    append_env_to_name: true,
    time: true
  }],
  
  // Deployment configuration
  deploy: {
    production: {
      user: 'adlinkpro',
      host: ['your-server.com'],
      ref: 'origin/main',
      repo: 'https://github.com/pronto1245/AdLinkPro.git',
      path: '/var/www/adlinkpro',
      'post-deploy': 'npm install && npm run build && pm2 reload ecosystem.config.js --env production',
      'pre-setup': 'apt update && apt install nodejs npm -y'
    },
    staging: {
      user: 'adlinkpro',
      host: 'staging-server.com',
      ref: 'origin/develop',
      repo: 'https://github.com/pronto1245/AdLinkPro.git',
      path: '/var/www/adlinkpro-staging',
      'post-deploy': 'npm install && npm run build && pm2 reload ecosystem.config.js --env staging'
    }
  }
};
```

---

## 🛡️ **NGINX.CONF - WEB СЕРВЕР КОНФИГУРАЦИЯ**

```nginx
# /etc/nginx/nginx.conf
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

# Оптимизация производительности
worker_rlimit_nofile 65535;

events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
    accept_mutex off;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # Логирование
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';
    
    access_log /var/log/nginx/access.log main;
    
    # Основные настройки
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    keepalive_requests 100;
    types_hash_max_size 2048;
    server_tokens off;
    
    # Размеры буферов
    client_body_buffer_size 128k;
    client_max_body_size 100m;
    client_header_buffer_size 1k;
    large_client_header_buffers 4 4k;
    
    # Таймауты
    client_body_timeout 12;
    client_header_timeout 12;
    send_timeout 10;
    
    # Gzip сжатие
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_min_length 1000;
    gzip_types
        application/atom+xml
        application/geo+json
        application/javascript
        application/x-javascript
        application/json
        application/ld+json
        application/manifest+json
        application/rdf+xml
        application/rss+xml
        application/xhtml+xml
        application/xml
        font/eot
        font/otf
        font/ttf
        image/svg+xml
        text/css
        text/javascript
        text/plain
        text/xml;
    
    # Brotli сжатие (если модуль установлен)
    # brotli on;
    # brotli_comp_level 6;
    # brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;
    limit_req_zone $binary_remote_addr zone=global:10m rate=100r/s;
    
    # Connection limiting
    limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;
    limit_conn_zone $server_name zone=conn_limit_per_server:10m;
    
    # Upstream для Node.js приложения
    upstream app_backend {
        least_conn;
        server 127.0.0.1:5000 max_fails=3 fail_timeout=30s weight=1;
        # Добавьте дополнительные серверы для масштабирования:
        # server 127.0.0.1:5001 max_fails=3 fail_timeout=30s weight=1;
        # server 127.0.0.1:5002 max_fails=3 fail_timeout=30s weight=1;
        keepalive 32;
    }
    
    # Кеширование
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=app_cache:10m max_size=1g inactive=60m use_temp_path=off;
    
    # Безопасность заголовков (глобально)
    add_header X-Frame-Options SAMEORIGIN always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # Настройки SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    ssl_session_tickets off;
    ssl_stapling on;
    ssl_stapling_verify on;
    
    # DH parameters для Perfect Forward Secrecy
    ssl_dhparam /etc/nginx/dhparam.pem;
    
    # Включение конфигураций виртуальных хостов
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

---

## 🔒 **DOCKER-COMPOSE.PROD.YML - PRODUCTION КОНТЕЙНЕРЫ**

```yaml
version: '3.8'

services:
  # Основное приложение AdLinkPro
  app:
    build:
      context: .
      dockerfile: Dockerfile.prod
      args:
        NODE_ENV: production
    container_name: adlinkpro-app
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - PORT=5000
      - DATABASE_URL=postgresql://adlinkpro:${DB_PASSWORD}@db:5432/adlinkpro
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=${JWT_SECRET}
      - SESSION_SECRET=${SESSION_SECRET}
      - SENDGRID_API_KEY=${SENDGRID_API_KEY}
      - VOLUUM_TOKEN=${VOLUUM_TOKEN}
      - KEITARO_TOKEN=${KEITARO_TOKEN}
      - BINOM_TOKEN=${BINOM_TOKEN}
      - GOOGLE_CLOUD_PROJECT_ID=${GOOGLE_CLOUD_PROJECT_ID}
      - GOOGLE_CLOUD_STORAGE_BUCKET=${GOOGLE_CLOUD_STORAGE_BUCKET}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - app_logs:/app/logs
      - app_uploads:/app/uploads
      - ./gcp-key.json:/app/gcp-key.json:ro
    networks:
      - adlinkpro-network
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:5000/api/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
        reservations:
          memory: 1G
          cpus: '0.5'

  # PostgreSQL база данных
  db:
    image: postgres:15-alpine
    container_name: adlinkpro-db
    restart: unless-stopped
    environment:
      - POSTGRES_DB=adlinkpro
      - POSTGRES_USER=adlinkpro
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C
      - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init-scripts:/docker-entrypoint-initdb.d:ro
      - ./postgresql.conf:/etc/postgresql/postgresql.conf:ro
    ports:
      - "5432:5432"
    networks:
      - adlinkpro-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U adlinkpro -d adlinkpro"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'
        reservations:
          memory: 512M
          cpus: '0.25'

  # Redis кеширование и сессии
  redis:
    image: redis:7-alpine
    container_name: adlinkpro-redis
    restart: unless-stopped
    command: redis-server /usr/local/etc/redis/redis.conf --appendonly yes
    volumes:
      - redis_data:/data
      - ./redis.conf:/usr/local/etc/redis/redis.conf:ro
    ports:
      - "6379:6379"
    networks:
      - adlinkpro-network
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.25'

  # Nginx reverse proxy
  nginx:
    image: nginx:alpine
    container_name: adlinkpro-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./certs:/etc/nginx/certs:ro
      - ./dhparam.pem:/etc/nginx/dhparam.pem:ro
      - nginx_logs:/var/log/nginx
      - nginx_cache:/var/cache/nginx
    depends_on:
      - app
    networks:
      - adlinkpro-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 128M
          cpus: '0.25'

  # Prometheus мониторинг
  prometheus:
    image: prom/prometheus:latest
    container_name: adlinkpro-prometheus
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - ./monitoring/rules:/etc/prometheus/rules:ro
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--storage.tsdb.retention.time=30d'
      - '--storage.tsdb.retention.size=10GB'
      - '--web.enable-lifecycle'
      - '--web.enable-admin-api'
    networks:
      - adlinkpro-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Grafana визуализация
  grafana:
    image: grafana/grafana:latest
    container_name: adlinkpro-grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards:ro
      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources:ro
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
      - GF_USERS_ALLOW_SIGN_UP=false
      - GF_USERS_ALLOW_ORG_CREATE=false
      - GF_AUTH_ANONYMOUS_ENABLED=false
      - GF_SECURITY_COOKIE_SECURE=true
      - GF_SECURITY_STRICT_TRANSPORT_SECURITY=true
      - GF_SNAPSHOTS_EXTERNAL_ENABLED=false
    networks:
      - adlinkpro-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Node Exporter для системных метрик
  node-exporter:
    image: prom/node-exporter:latest
    container_name: adlinkpro-node-exporter
    restart: unless-stopped
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.rootfs=/rootfs'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    networks:
      - adlinkpro-network

  # PostgreSQL Exporter
  postgres-exporter:
    image: prometheuscommunity/postgres-exporter:latest
    container_name: adlinkpro-postgres-exporter
    restart: unless-stopped
    ports:
      - "9187:9187"
    environment:
      - DATA_SOURCE_NAME=postgresql://adlinkpro:${DB_PASSWORD}@db:5432/adlinkpro?sslmode=disable
    depends_on:
      - db
    networks:
      - adlinkpro-network

  # Redis Exporter
  redis-exporter:
    image: oliver006/redis_exporter:latest
    container_name: adlinkpro-redis-exporter
    restart: unless-stopped
    ports:
      - "9121:9121"
    environment:
      - REDIS_ADDR=redis://redis:6379
    depends_on:
      - redis
    networks:
      - adlinkpro-network

  # Nginx Exporter
  nginx-exporter:
    image: nginx/nginx-prometheus-exporter:latest
    container_name: adlinkpro-nginx-exporter
    restart: unless-stopped
    ports:
      - "9113:9113"
    command:
      - '-nginx.scrape-uri=http://nginx:8080/nginx_status'
    depends_on:
      - nginx
    networks:
      - adlinkpro-network

  # Backup service
  backup:
    build:
      context: .
      dockerfile: Dockerfile.backup
    container_name: adlinkpro-backup
    restart: unless-stopped
    environment:
      - DB_PASSWORD=${DB_PASSWORD}
      - BACKUP_S3_BUCKET=${BACKUP_S3_BUCKET}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
    volumes:
      - backup_data:/backup
      - postgres_data:/postgres_data:ro
    depends_on:
      - db
    networks:
      - adlinkpro-network
    # Запуск backup каждый день в 2:00
    labels:
      - "cron.schedule=0 2 * * *"

volumes:
  postgres_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/adlinkpro/postgres
  redis_data:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/adlinkpro/redis
  app_logs:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/log/adlinkpro
  app_uploads:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/adlinkpro/uploads
  nginx_logs:
    driver: local
  nginx_cache:
    driver: local
  prometheus_data:
    driver: local
  grafana_data:
    driver: local
  backup_data:
    driver: local

networks:
  adlinkpro-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
          gateway: 172.20.0.1
    driver_opts:
      com.docker.network.bridge.name: adlinkpro-br0
```

**🎉 Полные конфигурации AdLinkPro готовы к production развертыванию!**